<!DOCTYPE html>
<html>
<head>
    <title>AMEG - Editar Cadastro</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/mobile.css">
    <style>
        body { font-family: Arial; margin: 0; background: #f4f4f4; }
        .header { background: #2c3e50; color: white; padding: 20px; }
        .nav { background: #34495e; padding: 15px; }
        .nav a { color: white; text-decoration: none; padding: 10px 20px; margin-right: 10px; background: #3498db; border-radius: 5px; }
        .container { padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        .form-group { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn { background: #27ae60; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #229954; }
        .logout { float: right; color: white; text-decoration: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1>AMEG - Editar Cadastro</h1>
        <a href="/logout" class="logout">Sair</a>
    </div>
    
    <div class="nav">
        <a href="/dashboard">Dashboard</a>
        <a href="/cadastrar">Novo Cadastro</a>
        <a href="/relatorios">Relat√≥rios</a>
        <a href="/exportar">Exportar CSV</a>
    </div>
    
    <div class="container">
        <div class="form-card">
            <h2>Editar Cadastro Familiar</h2>
            
            <form method="POST" action="/atualizar_cadastro/{{ cadastro.id }}" enctype="multipart/form-data">
                <h3>1. DADOS DO TITULAR</h3>
                
                <div class="form-group">
                    <label>Nome Completo *</label>
                    <input type="text" name="nome_completo" value="{{ cadastro.nome_completo if cadastro else '' }}" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Endere√ßo *</label>
                        <input type="text" name="endereco" value="{{ cadastro.endereco if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero *</label>
                        <input type="text" name="numero" value="{{ cadastro.numero if cadastro else '' }}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Bairro *</label>
                        <input type="text" name="bairro" value="{{ cadastro.bairro if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>CEP *</label>
                        <input type="text" name="cep" value="{{ cadastro.cep if cadastro else '' }}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Cidade *</label>
                        <input type="text" name="cidade" value="{{ cadastro.cidade if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <input type="text" name="estado" value="{{ cadastro.estado if cadastro else '' }}" required maxlength="2" placeholder="PB">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Telefone Celular *</label>
                        <input type="text" name="telefone" value="{{ cadastro.telefone if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>Ponto de Refer√™ncia</label>
                        <input type="text" name="ponto_referencia" value="{{ cadastro.ponto_referencia if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>G√™nero *</label>
                        <select name="genero" required>
                            <option value="">Selecione</option>
                            <option value="Masculino" {{ 'selected' if cadastro and cadastro.genero == 'Masculino' else '' }}>Masculino</option>
                            <option value="Feminino" {{ 'selected' if cadastro and cadastro.genero == 'Feminino' else '' }}>Feminino</option>
                            <option value="Cisg√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Cisg√™nero' else '' }}>Cisg√™nero</option>
                            <option value="Homem cis" {{ 'selected' if cadastro and cadastro.genero == 'Homem cis' else '' }}>Homem cis</option>
                            <option value="Mulher cis" {{ 'selected' if cadastro and cadastro.genero == 'Mulher cis' else '' }}>Mulher cis</option>
                            <option value="Transg√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Transg√™nero' else '' }}>Transg√™nero</option>
                            <option value="Homem trans" {{ 'selected' if cadastro and cadastro.genero == 'Homem trans' else '' }}>Homem trans</option>
                            <option value="Mulher trans" {{ 'selected' if cadastro and cadastro.genero == 'Mulher trans' else '' }}>Mulher trans</option>
                            <option value="Travesti" {{ 'selected' if cadastro and cadastro.genero == 'Travesti' else '' }}>Travesti</option>
                            <option value="N√£o-bin√°rio" {{ 'selected' if cadastro and cadastro.genero == 'N√£o-bin√°rio' else '' }}>N√£o-bin√°rio</option>
                            <option value="G√™nero fluido" {{ 'selected' if cadastro and cadastro.genero == 'G√™nero fluido' else '' }}>G√™nero fluido</option>
                            <option value="Ag√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Ag√™nero' else '' }}>Ag√™nero</option>
                            <option value="Big√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Big√™nero' else '' }}>Big√™nero</option>
                            <option value="Polig√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Polig√™nero' else '' }}>Polig√™nero</option>
                            <option value="Pang√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Pang√™nero' else '' }}>Pang√™nero</option>
                            <option value="Demig√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Demig√™nero' else '' }}>Demig√™nero</option>
                            <option value="Demi-boy" {{ 'selected' if cadastro and cadastro.genero == 'Demi-boy' else '' }}>Demi-boy</option>
                            <option value="Demi-girl" {{ 'selected' if cadastro and cadastro.genero == 'Demi-girl' else '' }}>Demi-girl</option>
                            <option value="Andr√≥gino" {{ 'selected' if cadastro and cadastro.genero == 'Andr√≥gino' else '' }}>Andr√≥gino</option>
                            <option value="Interg√™nero" {{ 'selected' if cadastro and cadastro.genero == 'Interg√™nero' else '' }}>Interg√™nero</option>
                            <option value="Neutrois" {{ 'selected' if cadastro and cadastro.genero == 'Neutrois' else '' }}>Neutrois</option>
                            <option value="Two-Spirit" {{ 'selected' if cadastro and cadastro.genero == 'Two-Spirit' else '' }}>Two-Spirit</option>
                            <option value="Queer" {{ 'selected' if cadastro and cadastro.genero == 'Queer' else '' }}>Queer</option>
                            <option value="G√™nero n√£o-conforme" {{ 'selected' if cadastro and cadastro.genero == 'G√™nero n√£o-conforme' else '' }}>G√™nero n√£o-conforme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Idade *</label>
                        <input type="number" name="idade" value="{{ cadastro.idade if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>Data Nascimento *</label>
                        <input type="date" name="data_nascimento" value="{{ cadastro.data_nascimento if cadastro else '' }}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∫ T√≠tulo de Eleitor</label>
                        <input type="text" name="titulo_eleitor" value="{{ cadastro.titulo_eleitor if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Cidade Emiss√£o T√≠tulo</label>
                        <input type="text" name="cidade_titulo" value="{{ cadastro.cidade_titulo if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>CPF *</label>
                        <input type="text" name="cpf" value="{{ cadastro.cpf if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>RG *</label>
                        <input type="text" name="rg" value="{{ cadastro.rg if cadastro else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label>NIS</label>
                        <input type="text" name="nis" value="{{ cadastro.nis if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Estado Civil *</label>
                        <select name="estado_civil" required>
                            <option value="">Selecione</option>
                            <option value="Solteiro(a)" {{ 'selected' if cadastro and cadastro.estado_civil == 'Solteiro(a)' else '' }}>Solteiro(a)</option>
                            <option value="Casado(a)" {{ 'selected' if cadastro and cadastro.estado_civil == 'Casado(a)' else '' }}>Casado(a)</option>
                            <option value="Separado(a) judicialmente" {{ 'selected' if cadastro and cadastro.estado_civil == 'Separado(a) judicialmente' else '' }}>Separado(a) judicialmente</option>
                            <option value="Divorciado(a)" {{ 'selected' if cadastro and cadastro.estado_civil == 'Divorciado(a)' else '' }}>Divorciado(a)</option>
                            <option value="Vi√∫vo(a)" {{ 'selected' if cadastro and cadastro.estado_civil == 'Vi√∫vo(a)' else '' }}>Vi√∫vo(a)</option>
                            <option value="Uni√£o Est√°vel" {{ 'selected' if cadastro and cadastro.estado_civil == 'Uni√£o Est√°vel' else '' }}>Uni√£o Est√°vel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Escolaridade *</label>
                        <select name="escolaridade" required>
                            <option value="">Selecione...</option>
                            <option value="Analfabeto" {{ 'selected' if cadastro and cadastro.escolaridade == 'Analfabeto' else '' }}>Analfabeto</option>
                            <option value="Educa√ß√£o Infantil" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o Infantil' else '' }}>Educa√ß√£o Infantil</option>
                            <option value="Ensino Fundamental" {{ 'selected' if cadastro and cadastro.escolaridade == 'Ensino Fundamental' else '' }}>Ensino Fundamental</option>
                            <option value="Ensino M√©dio" {{ 'selected' if cadastro and cadastro.escolaridade == 'Ensino M√©dio' else '' }}>Ensino M√©dio</option>
                            <option value="Gradua√ß√£o Bacharelado" {{ 'selected' if cadastro and cadastro.escolaridade == 'Gradua√ß√£o Bacharelado' else '' }}>Gradua√ß√£o Bacharelado</option>
                            <option value="Gradua√ß√£o Licenciatura" {{ 'selected' if cadastro and cadastro.escolaridade == 'Gradua√ß√£o Licenciatura' else '' }}>Gradua√ß√£o Licenciatura</option>
                            <option value="Gradua√ß√£o Tecnol√≥gico" {{ 'selected' if cadastro and cadastro.escolaridade == 'Gradua√ß√£o Tecnol√≥gico' else '' }}>Gradua√ß√£o Tecnol√≥gico</option>
                            <option value="P√≥s-gradua√ß√£o Lato sensu" {{ 'selected' if cadastro and cadastro.escolaridade == 'P√≥s-gradua√ß√£o Lato sensu' else '' }}>P√≥s-gradua√ß√£o Lato sensu</option>
                            <option value="P√≥s-gradua√ß√£o Stricto sensu" {{ 'selected' if cadastro and cadastro.escolaridade == 'P√≥s-gradua√ß√£o Stricto sensu' else '' }}>P√≥s-gradua√ß√£o Stricto sensu</option>
                            <option value="Educa√ß√£o de Jovens e Adultos (EJA)" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o de Jovens e Adultos (EJA)' else '' }}>Educa√ß√£o de Jovens e Adultos (EJA)</option>
                            <option value="Educa√ß√£o Profissional e Tecnol√≥gica (EPT)" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o Profissional e Tecnol√≥gica (EPT)' else '' }}>Educa√ß√£o Profissional e Tecnol√≥gica (EPT)</option>
                            <option value="Educa√ß√£o Especial" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o Especial' else '' }}>Educa√ß√£o Especial</option>
                            <option value="Educa√ß√£o Ind√≠gena" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o Ind√≠gena' else '' }}>Educa√ß√£o Ind√≠gena</option>
                            <option value="Educa√ß√£o do Campo" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o do Campo' else '' }}>Educa√ß√£o do Campo</option>
                            <option value="Educa√ß√£o Quilombola" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o Quilombola' else '' }}>Educa√ß√£o Quilombola</option>
                            <option value="Educa√ß√£o a Dist√¢ncia (EaD)" {{ 'selected' if cadastro and cadastro.escolaridade == 'Educa√ß√£o a Dist√¢ncia (EaD)' else '' }}>Educa√ß√£o a Dist√¢ncia (EaD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profiss√£o *</label>
                        <input type="text" name="profissao" value="{{ cadastro.profissao if cadastro else '' }}" required>
                    </div>
                </div>
                
                <h3>DADOS DO COMPANHEIRO</h3>
                
                <div class="form-group">
                    <label>Nome Companheiro</label>
                    <input type="text" name="nome_companheiro" value="{{ cadastro.nome_companheiro if cadastro else '' }}">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>CPF Companheiro</label>
                        <input type="text" name="cpf_companheiro" value="{{ cadastro.cpf_companheiro if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>RG Companheiro</label>
                        <input type="text" name="rg_companheiro" value="{{ cadastro.rg_companheiro if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Idade Companheiro</label>
                        <input type="number" name="idade_companheiro" value="{{ cadastro.idade_companheiro if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>T√≠tulo Eleitor Companheiro</label>
                        <input type="text" name="titulo_companheiro" value="{{ cadastro.titulo_companheiro if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Cidade T√≠tulo Companheiro</label>
                        <input type="text" name="cidade_titulo_companheiro" value="{{ cadastro.cidade_titulo_companheiro if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>NIS Companheiro</label>
                        <input type="text" name="nis_companheiro" value="{{ cadastro.nis_companheiro if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Escolaridade Companheiro</label>
                        <select name="escolaridade_companheiro">
                            <option value="">Selecione...</option>
                            <option value="Analfabeto" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Analfabeto' else '' }}>Analfabeto</option>
                            <option value="Educa√ß√£o Infantil" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o Infantil' else '' }}>Educa√ß√£o Infantil</option>
                            <option value="Ensino Fundamental" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Ensino Fundamental' else '' }}>Ensino Fundamental</option>
                            <option value="Ensino M√©dio" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Ensino M√©dio' else '' }}>Ensino M√©dio</option>
                            <option value="Gradua√ß√£o Bacharelado" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Gradua√ß√£o Bacharelado' else '' }}>Gradua√ß√£o Bacharelado</option>
                            <option value="Gradua√ß√£o Licenciatura" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Gradua√ß√£o Licenciatura' else '' }}>Gradua√ß√£o Licenciatura</option>
                            <option value="Gradua√ß√£o Tecnol√≥gico" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Gradua√ß√£o Tecnol√≥gico' else '' }}>Gradua√ß√£o Tecnol√≥gico</option>
                            <option value="P√≥s-gradua√ß√£o Lato sensu" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'P√≥s-gradua√ß√£o Lato sensu' else '' }}>P√≥s-gradua√ß√£o Lato sensu</option>
                            <option value="P√≥s-gradua√ß√£o Stricto sensu" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'P√≥s-gradua√ß√£o Stricto sensu' else '' }}>P√≥s-gradua√ß√£o Stricto sensu</option>
                            <option value="Educa√ß√£o de Jovens e Adultos (EJA)" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o de Jovens e Adultos (EJA)' else '' }}>Educa√ß√£o de Jovens e Adultos (EJA)</option>
                            <option value="Educa√ß√£o Profissional e Tecnol√≥gica (EPT)" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o Profissional e Tecnol√≥gica (EPT)' else '' }}>Educa√ß√£o Profissional e Tecnol√≥gica (EPT)</option>
                            <option value="Educa√ß√£o Especial" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o Especial' else '' }}>Educa√ß√£o Especial</option>
                            <option value="Educa√ß√£o Ind√≠gena" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o Ind√≠gena' else '' }}>Educa√ß√£o Ind√≠gena</option>
                            <option value="Educa√ß√£o do Campo" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o do Campo' else '' }}>Educa√ß√£o do Campo</option>
                            <option value="Educa√ß√£o Quilombola" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o Quilombola' else '' }}>Educa√ß√£o Quilombola</option>
                            <option value="Educa√ß√£o a Dist√¢ncia (EaD)" {{ 'selected' if cadastro and cadastro.escolaridade_companheiro == 'Educa√ß√£o a Dist√¢ncia (EaD)' else '' }}>Educa√ß√£o a Dist√¢ncia (EaD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profiss√£o Companheiro</label>
                        <input type="text" name="profissao_companheiro" value="{{ cadastro.profissao_companheiro if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Data Nascimento Companheiro</label>
                        <input type="date" name="data_nascimento_companheiro" value="{{ cadastro.data_nascimento_companheiro if cadastro else '' }}">
                    </div>
                </div>
                
                <h3>2. DADOS DE RENDA FAMILIAR</h3>
                
                <div class="form-group">
                    <label>Tipo de Trabalho</label>
                    <select name="tipo_trabalho">
                        <option value="">Selecione</option>
                        <option value="Assalariado com carteira" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Assalariado com carteira' else '' }}>Assalariado com carteira</option>
                        <option value="Assalariado sem carteira" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Assalariado sem carteira' else '' }}>Assalariado sem carteira</option>
                        <option value="Trabalhador Aut√¥nomo" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Trabalhador Aut√¥nomo' else '' }}>Trabalhador Aut√¥nomo</option>
                        <option value="Aposentado" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Aposentado' else '' }}>Aposentado</option>
                        <option value="Pensionista" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Pensionista' else '' }}>Pensionista</option>
                        <option value="BPC" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'BPC' else '' }}>BPC</option>
                        <option value="Funcion√°rio P√∫blico" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Funcion√°rio P√∫blico' else '' }}>Funcion√°rio P√∫blico</option>
                        <option value="Desempregado" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Desempregado' else '' }}>Desempregado</option>
                        <option value="Outros" {{ 'selected' if cadastro and cadastro.tipo_trabalho == 'Outros' else '' }}>Outros</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantas pessoas trabalham?</label>
                        <input type="number" name="pessoas_trabalham" value="{{ cadastro.pessoas_trabalham if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Quantos Aposentados/Pensionistas?</label>
                        <input type="number" name="aposentados_pensionistas" value="{{ cadastro.aposentados_pensionistas if cadastro else '0' }}" required min="0">
                    </div>
                </div>
                
                <h3>3. DETALHAMENTO FAMILIAR</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∫ Pessoas na Fam√≠lia</label>
                        <input type="number" name="num_pessoas_familia" value="{{ cadastro.num_pessoas_familia if cadastro else '1' }}" required min="1">
                    </div>
                    <div class="form-group">
                        <label>N¬∫ de Fam√≠lias</label>
                        <select name="num_familias">
                            <option value="">Selecione</option>
                            <option value="1" {{ 'selected' if cadastro and cadastro.num_familias == '1' else '' }}>1 Fam√≠lia</option>
                            <option value="2" {{ 'selected' if cadastro and cadastro.num_familias == '2' else '' }}>2 Fam√≠lias</option>
                            <option value="3" {{ 'selected' if cadastro and cadastro.num_familias == '3' else '' }}>Mais de 2 fam√≠lias</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Adultos</label>
                        <input type="number" name="adultos" value="{{ cadastro.adultos if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Crian√ßas</label>
                        <input type="number" name="criancas" value="{{ cadastro.criancas if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Adolescentes</label>
                        <input type="number" name="adolescentes" value="{{ cadastro.adolescentes if cadastro else '0' }}" required min="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Idosos</label>
                        <input type="number" name="idosos" value="{{ cadastro.idosos if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Gestantes</label>
                        <input type="number" name="gestantes" value="{{ cadastro.gestantes if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Nutrizes</label>
                        <input type="number" name="nutrizes" value="{{ cadastro.nutrizes if cadastro else '0' }}" required min="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Renda Familiar Bruta (R$)</label>
                        <input type="number" step="0.01" name="renda_familiar" value="{{ cadastro.renda_familiar if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Renda Per Capita (R$)</label>
                        <input type="number" step="0.01" name="renda_per_capita" value="{{ cadastro.renda_per_capita if cadastro else '0' }}" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Bolsa Fam√≠lia (R$)</label>
                        <input type="number" step="0.01" name="bolsa_familia" value="{{ cadastro.bolsa_familia if cadastro else '0' }}" required min="0">
                    </div>
                </div>
                
                <h3>DADOS DA MORADIA</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Casa</label>
                        <select name="casa_tipo">
                            <option value="">Selecione</option>
                            <option value="pr√≥pria" {{ 'selected' if cadastro and cadastro.casa_tipo == 'pr√≥pria' else '' }}>Pr√≥pria</option>
                            <option value="alugada" {{ 'selected' if cadastro and cadastro.casa_tipo == 'alugada' else '' }}>Alugada</option>
                            <option value="cedida" {{ 'selected' if cadastro and cadastro.casa_tipo == 'cedida' else '' }}>Cedida</option>
                            <option value="invadida" {{ 'selected' if cadastro and cadastro.casa_tipo == 'invadida' else '' }}>Invadida</option>
                            <option value="compartilhada" {{ 'selected' if cadastro and cadastro.casa_tipo == 'compartilhada' else '' }}>Compartilhada</option>
                            <option value="outros" {{ 'selected' if cadastro and cadastro.casa_tipo == 'outros' else '' }}>Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo Material</label>
                        <select name="casa_material">
                            <option value="">Selecione</option>
                            <option value="alvenaria" {{ 'selected' if cadastro and cadastro.casa_material == 'alvenaria' else '' }}>Alvenaria</option>
                            <option value="mista" {{ 'selected' if cadastro and cadastro.casa_material == 'mista' else '' }}>Mista</option>
                            <option value="taipa" {{ 'selected' if cadastro and cadastro.casa_material == 'taipa' else '' }}>Taipa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Energia</label>
                        <select name="energia">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.energia == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.energia == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Lixo</label>
                        <select name="lixo">
                            <option value="">Selecione</option>
                            <option value="coletado" {{ 'selected' if cadastro and cadastro.lixo == 'coletado' else '' }}>Coletado</option>
                            <option value="queimado" {{ 'selected' if cadastro and cadastro.lixo == 'queimado' else '' }}>Queimado</option>
                            <option value="enterrado" {{ 'selected' if cadastro and cadastro.lixo == 'enterrado' else '' }}>Enterrado</option>
                            <option value="outros" {{ 'selected' if cadastro and cadastro.lixo == 'outros' else '' }}>Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√Ågua</label>
                        <select name="agua">
                            <option value="">Selecione</option>
                            <option value="encanada" {{ 'selected' if cadastro and cadastro.agua == 'encanada' else '' }}>Encanada</option>
                            <option value="po√ßo" {{ 'selected' if cadastro and cadastro.agua == 'po√ßo' else '' }}>Po√ßo</option>
                            <option value="cisterna" {{ 'selected' if cadastro and cadastro.agua == 'cisterna' else '' }}>Cisterna</option>
                            <option value="outros" {{ 'selected' if cadastro and cadastro.agua == 'outros' else '' }}>Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Esgoto</label>
                        <select name="esgoto">
                            <option value="">Selecione</option>
                            <option value="saneado" {{ 'selected' if cadastro and cadastro.esgoto == 'saneado' else '' }}>Saneado</option>
                            <option value="fossa" {{ 'selected' if cadastro and cadastro.esgoto == 'fossa' else '' }}>Fossa</option>
                            <option value="outros" {{ 'selected' if cadastro and cadastro.esgoto == 'outros' else '' }}>Outros</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea name="observacoes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">{{ cadastro.observacoes if cadastro else '' }}</textarea>
                </div>
                
                <h3>DADOS DA SA√öDE DA FAM√çLIA</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tem doen√ßa cr√¥nica?</label>
                        <select name="tem_doenca_cronica" onchange="toggleField(this, 'doencas_cronicas')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.tem_doenca_cronica == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.tem_doenca_cronica == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quais doen√ßas cr√¥nicas?</label>
                        <input type="text" name="doencas_cronicas" id="doencas_cronicas" value="{{ cadastro.doencas_cronicas if cadastro else '' }}" placeholder="Ex: Diabetes, Hipertens√£o">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Usa medicamento cont√≠nuo?</label>
                        <select name="usa_medicamento_continuo" onchange="toggleField(this, 'medicamentos_continuos')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.usa_medicamento_continuo == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.usa_medicamento_continuo == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quais medicamentos?</label>
                        <input type="text" name="medicamentos_continuos" id="medicamentos_continuos" value="{{ cadastro.medicamentos_continuos if cadastro else '' }}" placeholder="Ex: Insulina, Captopril">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tem doen√ßa mental?</label>
                        <select name="tem_doenca_mental" onchange="toggleField(this, 'doencas_mentais')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.tem_doenca_mental == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.tem_doenca_mental == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quais doen√ßas mentais?</label>
                        <input type="text" name="doencas_mentais" id="doencas_mentais" value="{{ cadastro.doencas_mentais if cadastro else '' }}" placeholder="Ex: Depress√£o, Ansiedade">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tem defici√™ncia?</label>
                        <select name="tem_deficiencia" onchange="toggleField(this, 'tipo_deficiencia')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.tem_deficiencia == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.tem_deficiencia == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo de defici√™ncia?</label>
                        <input type="text" name="tipo_deficiencia" id="tipo_deficiencia" value="{{ cadastro.tipo_deficiencia if cadastro else '' }}" placeholder="Ex: Visual, Auditiva, F√≠sica">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Precisa de cuidados especiais?</label>
                        <select name="precisa_cuidados_especiais" onchange="toggleField(this, 'cuidados_especiais')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.precisa_cuidados_especiais == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.precisa_cuidados_especiais == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quais cuidados?</label>
                        <input type="text" name="cuidados_especiais" id="cuidados_especiais" value="{{ cadastro.cuidados_especiais if cadastro else '' }}" placeholder="Ex: Fisioterapia, Acompanhamento m√©dico">
                    </div>
                </div>
                
                <h3>ANEXOS DE SA√öDE</h3>
                <p style="color: #666; font-size: 14px;">Anexe laudos m√©dicos, receitas ou imagens relacionadas √† sa√∫de (PDF, PNG, JPG, DOC - m√°x. 16MB cada)</p>
                
                <!-- Campos para adicionar novos arquivos -->
                <div class="form-row">
                    <div class="form-group">
                        <label>üìã Laudo M√©dico</label>
                        <input type="file" name="laudo" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx">
                        <input type="text" name="descricao_laudo" placeholder="Descri√ß√£o do laudo (opcional)" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>üíä Receita M√©dica</label>
                        <input type="file" name="receita" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx">
                        <input type="text" name="descricao_receita" placeholder="Descri√ß√£o da receita (opcional)" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>üì∑ Imagem/Exame</label>
                        <input type="file" name="imagem" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx">
                        <input type="text" name="descricao_imagem" placeholder="Descri√ß√£o da imagem (opcional)" style="margin-top: 5px;">
                    </div>
                </div>
                
                <!-- Lista de arquivos existentes -->
                {% if arquivos_saude %}
                <div style="margin-top: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #3498db;">
                    <h4 style="margin-top: 0; color: #2c3e50; display: flex; align-items: center;">
                        üìÅ Arquivos Anexados ({{ arquivos_saude|length }})
                    </h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        {% for arquivo in arquivos_saude %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: white; border-radius: 5px; border: 1px solid #dee2e6;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 4px;">
                                    üìé {{ arquivo.nome_arquivo }}
                                </div>
                                {% if arquivo.descricao %}
                                <div style="color: #666; font-size: 14px; margin-bottom: 4px;">
                                    {{ arquivo.descricao }}
                                </div>
                                {% endif %}
                                <div style="color: #999; font-size: 12px;">
                                    üìÖ Enviado em: {{ arquivo.data_upload.strftime('%d/%m/%Y √†s %H:%M') if arquivo.data_upload else 'Data n√£o dispon√≠vel' }}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <a href="/download_arquivo/{{ arquivo.id }}" 
                                   style="background: #3498db; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: flex; align-items: center; gap: 4px;"
                                   title="Baixar arquivo">
                                    üì• Download
                                </a>
                                <a href="/excluir_arquivo/{{ arquivo.id }}" 
                                   style="background: #e74c3c; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: flex; align-items: center; gap: 4px;"
                                   onclick="return confirm('‚ö†Ô∏è Tem certeza que deseja excluir o arquivo \'{{ arquivo.nome_arquivo }}\'?\n\nEsta a√ß√£o n√£o pode ser desfeita.')"
                                   title="Excluir arquivo">
                                    üóëÔ∏è Excluir
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: #e8f4fd; border-radius: 4px; font-size: 13px; color: #2c3e50;">
                        üí° <strong>Dica:</strong> Para atualizar um arquivo, exclua o arquivo antigo e adicione o novo arquivo usando os campos acima.
                    </div>
                </div>
                {% else %}
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                    <div style="color: #856404; font-size: 14px;">
                        üìã <strong>Nenhum arquivo anexado ainda.</strong><br>
                        Use os campos acima para adicionar laudos m√©dicos, receitas ou exames.
                    </div>
                </div>
                {% endif %}
                
                <script>
                function toggleField(select, targetId) {
                    const target = document.getElementById(targetId);
                    if (select.value === 'Sim') {
                        target.disabled = false;
                        target.style.backgroundColor = '#fff';
                    } else {
                        target.disabled = true;
                        target.value = '';
                        target.style.backgroundColor = '#f5f5f5';
                    }
                }
                
                // Formata√ß√£o e valida√ß√£o de CPF
                function formatCPF(input) {
                    let value = input.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                function validarCPF(cpf) {
                    cpf = cpf.replace(/[^\d]+/g, '');
                    if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
                    
                    let soma = 0;
                    for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i);
                    let resto = (soma * 10) % 11;
                    if (resto === 10 || resto === 11) resto = 0;
                    if (resto !== parseInt(cpf.charAt(9))) return false;
                    
                    soma = 0;
                    for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i);
                    resto = (soma * 10) % 11;
                    if (resto === 10 || resto === 11) resto = 0;
                    return resto === parseInt(cpf.charAt(10));
                }
                
                function validarCPFInput(input) {
                    const cpf = input.value.replace(/[^\d]+/g, '');
                    if (cpf.length === 11 && !validarCPF(cpf)) {
                        input.setCustomValidity('CPF inv√°lido');
                        input.style.borderColor = '#e74c3c';
                    } else {
                        input.setCustomValidity('');
                        input.style.borderColor = '#ddd';
                    }
                }
                
                // Formata√ß√£o de telefone
                function formatTelefone(input) {
                    let value = input.value.replace(/\D/g, '');
                    if (value.length <= 11) {
                        value = value.replace(/(\d{2})(\d)/, '($1) $2');
                        value = value.replace(/(\d{4})(\d)/, '$1-$2');
                    }
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                // Formata√ß√£o de CEP
                function formatCEP(input) {
                    let value = input.value.replace(/\D/g, '');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                // Buscar endere√ßo pelo CEP
                function buscarCEP(cep) {
                    const cepLimpo = cep.replace(/\D/g, '');
                    
                    // Validar formato do CEP
                    if (cepLimpo.length !== 8) {
                        return; // N√£o buscar se CEP n√£o tem 8 d√≠gitos
                    }
                    
                    // Evitar m√∫ltiplas requisi√ß√µes para o mesmo CEP inv√°lido
                    if (window.lastInvalidCep === cepLimpo) {
                        return;
                    }
                    
                    fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.erro) {
                                document.querySelector('input[name="endereco"]').value = data.logradouro || '';
                                document.querySelector('input[name="bairro"]').value = data.bairro || '';
                                document.querySelector('input[name="cidade"]').value = data.localidade || '';
                                document.querySelector('input[name="estado"]').value = data.uf || '';
                                document.querySelector('input[name="numero"]').focus();
                                // Limpar CEP inv√°lido anterior
                                window.lastInvalidCep = null;
                            } else {
                                // Marcar CEP como inv√°lido para evitar loop
                                window.lastInvalidCep = cepLimpo;
                                alert('CEP n√£o encontrado! Verifique o formato.');
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao buscar CEP:', error);
                            window.lastInvalidCep = cepLimpo;
                        });
                }
                
                // Aplicar formata√ß√£o aos campos
                document.addEventListener('DOMContentLoaded', function() {
                    const cpfInputs = document.querySelectorAll('input[name="cpf"], input[name="cpf_companheiro"]');
                    cpfInputs.forEach(input => {
                        input.addEventListener('input', function() {
                            formatCPF(this);
                            validarCPFInput(this);
                        });
                        input.maxLength = 14;
                        input.pattern = '\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}';
                    });
                    
                    const telefoneInput = document.querySelector('input[name="telefone"]');
                    if (telefoneInput) {
                        telefoneInput.addEventListener('input', function() {
                            formatTelefone(this);
                        });
                        telefoneInput.maxLength = 15;
                        telefoneInput.placeholder = '(XX) XXXX-XXXX';
                    }
                    
                    const cepInput = document.querySelector('input[name="cep"]');
                    if (cepInput) {
                        cepInput.addEventListener('input', function() {
                            formatCEP(this);
                        });
                        cepInput.addEventListener('blur', function() {
                            const cepLimpo = this.value.replace(/\D/g, '');
                            // S√≥ buscar se CEP tem 8 d√≠gitos e n√£o foi buscado antes
                            if (cepLimpo.length === 8 && window.lastSearchedCep !== cepLimpo) {
                                window.lastSearchedCep = cepLimpo;
                                buscarCEP(this.value);
                            }
                        });
                        cepInput.maxLength = 10;
                        cepInput.placeholder = 'XXXXX-XX';
                    }
                });

                // Controlar campos do companheiro baseado no estado civil
                const estadoCivil = document.querySelector('select[name="estado_civil"]');
                const camposCompanheiro = ['idade_companheiro', 'data_nascimento_companheiro'];
                
                function toggleCamposCompanheiro() {
                    const isSolteiro = estadoCivil.value === 'Solteiro(a)';
                    camposCompanheiro.forEach(campo => {
                        const input = document.querySelector(`input[name="${campo}"]`);
                        if (input) {
                            if (isSolteiro) {
                                input.removeAttribute('required');
                                input.value = '';
                            } else {
                                input.setAttribute('required', 'required');
                            }
                        }
                    });
                }
                
                if (estadoCivil) {
                    estadoCivil.addEventListener('change', toggleCamposCompanheiro);
                    toggleCamposCompanheiro();
                }
                </script>
                
                <!-- ATIVIDADE DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üìã Atividade de Trabalho</h3>
                
                <div class="form-group">
                    <label>Com o que voc√™ trabalha?</label>
                    <input type="text" name="com_que_trabalha" value="{{ cadastro.com_que_trabalha if cadastro else '' }}">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Onde trabalha?</label>
                        <input type="text" name="onde_trabalha" value="{{ cadastro.onde_trabalha if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Localiza√ß√£o de trabalho</label>
                        <select name="localizacao_trabalho">
                            <option value="">Selecione</option>
                            <option value="Orla cedo" {{ 'selected' if cadastro and cadastro.localizacao_trabalho == 'Orla cedo' else '' }}>Orla cedo</option>
                            <option value="Orla noite" {{ 'selected' if cadastro and cadastro.localizacao_trabalho == 'Orla noite' else '' }}>Orla noite</option>
                            <option value="Bessa" {{ 'selected' if cadastro and cadastro.localizacao_trabalho == 'Bessa' else '' }}>Bessa</option>
                            <option value="Centro" {{ 'selected' if cadastro and cadastro.localizacao_trabalho == 'Centro' else '' }}>Centro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Qual √© o seu hor√°rio de trabalho?</label>
                        <input type="text" name="horario_trabalho" value="{{ cadastro.horario_trabalho if cadastro else '' }}" placeholder="08:00 a 17:00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>H√° quanto tempo atua nessa atividade?</label>
                        <input type="text" name="tempo_atividade" value="{{ cadastro.tempo_atividade if cadastro else '' }}">
                    </div>
                    <div class="form-group">
                        <label>Atua em ponto fixo?</label>
                        <select name="atua_ponto_fixo" onchange="toggleField(this, 'qual_ponto_fixo')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.atua_ponto_fixo == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.atua_ponto_fixo == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Qual ponto?</label>
                    <input type="text" name="qual_ponto_fixo" id="qual_ponto_fixo" value="{{ cadastro.qual_ponto_fixo if cadastro else '' }}">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantos dias por semana trabalha?</label>
                        <input type="number" name="dias_semana_trabalha" value="{{ cadastro.dias_semana_trabalha if cadastro else '' }}" min="1" max="7">
                    </div>
                    <div class="form-group">
                        <label>Seu trabalho √© cont√≠nuo ou por temporada?</label>
                        <select name="trabalho_continuo_temporada">
                            <option value="">Selecione</option>
                            <option value="Cont√≠nuo" {{ 'selected' if cadastro and cadastro.trabalho_continuo_temporada == 'Cont√≠nuo' else '' }}>Cont√≠nuo</option>
                            <option value="Temporada" {{ 'selected' if cadastro and cadastro.trabalho_continuo_temporada == 'Temporada' else '' }}>Por temporada</option>
                        </select>
                    </div>
                </div>
                
                <!-- CONDI√á√ïES DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">‚ö†Ô∏è Condi√ß√µes de Trabalho</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>J√° sofreu acidente no ambiente de trabalho?</label>
                        <select name="sofreu_acidente_trabalho" onchange="toggleField(this, 'qual_acidente')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.sofreu_acidente_trabalho == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.sofreu_acidente_trabalho == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qual acidente?</label>
                        <input type="text" name="qual_acidente" id="qual_acidente" value="{{ cadastro.qual_acidente if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>No seu trabalho, o que mais incomoda?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_calor" value="Sim" {{ 'checked' if cadastro and cadastro.trabalho_incomoda_calor == 'Sim' else '' }} style="margin-right: 5px;"> Calor
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_barulho" value="Sim" {{ 'checked' if cadastro and cadastro.trabalho_incomoda_barulho == 'Sim' else '' }} style="margin-right: 5px;"> Barulho
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_seguranca" value="Sim" {{ 'checked' if cadastro and cadastro.trabalho_incomoda_seguranca == 'Sim' else '' }} style="margin-right: 5px;"> Seguran√ßa
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_banheiros" value="Sim" {{ 'checked' if cadastro and cadastro.trabalho_incomoda_banheiros == 'Sim' else '' }} style="margin-right: 5px;"> Aus√™ncia de banheiros
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_outro" value="Sim" {{ 'checked' if cadastro and cadastro.trabalho_incomoda_outro == 'Sim' else '' }} style="margin-right: 5px;" onchange="toggleField(this, 'trabalho_incomoda_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="trabalho_incomoda_outro_desc" id="trabalho_incomoda_outro_desc" value="{{ cadastro.trabalho_incomoda_outro_desc if cadastro else '' }}" placeholder="Especifique" style="margin-top: 10px;">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tem acesso a banheiro e √°gua pot√°vel durante o trabalho?</label>
                        <select name="acesso_banheiro_agua">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.acesso_banheiro_agua == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.acesso_banheiro_agua == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Costuma trabalhar sozinho(a) ou com ajudantes? Quantos?</label>
                        <input type="text" name="trabalha_sozinho_ajudantes" value="{{ cadastro.trabalha_sozinho_ajudantes if cadastro else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Possui autoriza√ß√£o/licen√ßa municipal para atuar?</label>
                        <select name="possui_autorizacao_municipal">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.possui_autorizacao_municipal == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.possui_autorizacao_municipal == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Costuma ter problemas com fiscaliza√ß√£o ou viol√™ncia policial?</label>
                        <select name="problemas_fiscalizacao_policia">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.problemas_fiscalizacao_policia == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.problemas_fiscalizacao_policia == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                </div>
                
                <!-- ESTRUTURA DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üèóÔ∏è Estrutura de Trabalho</h3>
                
                <div class="form-group">
                    <label>Qual estrutura utiliza?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_barraca" value="Sim" {{ 'checked' if cadastro and cadastro.estrutura_barraca == 'Sim' else '' }} style="margin-right: 5px;"> Barraca
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_carrinho" value="Sim" {{ 'checked' if cadastro and cadastro.estrutura_carrinho == 'Sim' else '' }} style="margin-right: 5px;"> Carrinho
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_mesa" value="Sim" {{ 'checked' if cadastro and cadastro.estrutura_mesa == 'Sim' else '' }} style="margin-right: 5px;"> Mesa
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_outro" value="Sim" {{ 'checked' if cadastro and cadastro.estrutura_outro == 'Sim' else '' }} style="margin-right: 5px;" onchange="toggleField(this, 'estrutura_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="estrutura_outro_desc" id="estrutura_outro_desc" value="{{ cadastro.estrutura_outro_desc if cadastro else '' }}" placeholder="Especifique" style="margin-top: 10px;">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Necessita energia el√©trica?</label>
                        <select name="necessita_energia_eletrica">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.necessita_energia_eletrica == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.necessita_energia_eletrica == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Utiliza g√°s de cozinha?</label>
                        <select name="utiliza_gas_cozinha">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.utiliza_gas_cozinha == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.utiliza_gas_cozinha == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Usa ve√≠culo pr√≥prio para transporte?</label>
                        <select name="usa_veiculo_proprio" onchange="toggleField(this, 'qual_veiculo')">
                            <option value="">Selecione</option>
                            <option value="Sim" {{ 'selected' if cadastro and cadastro.usa_veiculo_proprio == 'Sim' else '' }}>Sim</option>
                            <option value="N√£o" {{ 'selected' if cadastro and cadastro.usa_veiculo_proprio == 'N√£o' else '' }}>N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qual ve√≠culo?</label>
                        <input type="text" name="qual_veiculo" id="qual_veiculo" value="{{ cadastro.qual_veiculo if cadastro else '' }}">
                    </div>
                </div>
                
                <!-- RENDA E FAM√çLIA -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üí∞ Renda e Fam√≠lia</h3>
                
                <div class="form-group">
                    <label>Qual √© a principal fonte de renda da sua fam√≠lia?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_trabalho_ambulante" value="Sim" {{ 'checked' if cadastro and cadastro.fonte_renda_trabalho_ambulante == 'Sim' else '' }} style="margin-right: 5px;"> Trabalho ambulante
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_aposentadoria" value="Sim" {{ 'checked' if cadastro and cadastro.fonte_renda_aposentadoria == 'Sim' else '' }} style="margin-right: 5px;"> Aposentadoria
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_beneficio_social" value="Sim" {{ 'checked' if cadastro and cadastro.fonte_renda_beneficio_social == 'Sim' else '' }} style="margin-right: 5px;"> Benef√≠cio social
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_outro" value="Sim" {{ 'checked' if cadastro and cadastro.fonte_renda_outro == 'Sim' else '' }} style="margin-right: 5px;" onchange="toggleField(this, 'fonte_renda_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="fonte_renda_outro_desc" id="fonte_renda_outro_desc" value="{{ cadastro.fonte_renda_outro_desc if cadastro else '' }}" placeholder="Especifique" style="margin-top: 10px;">
                </div>
                
                <div class="form-group">
                    <label>Quantas pessoas dependem diretamente da sua renda?</label>
                    <input type="number" name="pessoas_dependem_renda" value="{{ cadastro.pessoas_dependem_renda if cadastro else '' }}" min="0">
                </div>
                
                <button type="submit" class="btn">Atualizar Cadastro</button>
            </form>
        </div>
    </div>

    <script>
    // Limites dos campos conforme definido na tabela do banco
    const FIELD_LIMITS = {
        'nome_completo': 255,
        'numero': 10,
        'bairro': 100,
        'cidade': 100,
        'estado': 2,
        'cep': 10,
        'telefone': 20,
        'titulo_eleitor': 20,
        'cidade_titulo': 100,
        'cpf': 14,
        'rg': 20,
        'nis': 20,
        'estado_civil': 30,
        'escolaridade': 100,
        'profissao': 100,
        'nome_companheiro': 255,
        'cpf_companheiro': 14,
        'rg_companheiro': 20,
        'escolaridade_companheiro': 100,
        'profissao_companheiro': 100,
        'titulo_companheiro': 20,
        'cidade_titulo_companheiro': 100,
        'nis_companheiro': 20,
        'tipo_trabalho': 100,
        'localizacao_trabalho': 50,
        'casa_tipo': 50,
        'casa_material': 50
    };

    // Fun√ß√£o para validar campo em tempo real
    function validateField(input) {
        const fieldName = input.name;
        const maxLength = FIELD_LIMITS[fieldName];
        
        if (maxLength && input.value.length > maxLength) {
            input.style.borderColor = '#dc3545';
            input.style.backgroundColor = '#fff5f5';
            
            // Remover aviso anterior se existir
            let existingWarning = input.parentNode.querySelector('.length-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            // Adicionar aviso
            const warning = document.createElement('div');
            warning.className = 'length-warning';
            warning.style.color = '#dc3545';
            warning.style.fontSize = '12px';
            warning.style.marginTop = '2px';
            warning.textContent = `M√°ximo ${maxLength} caracteres (atual: ${input.value.length})`;
            input.parentNode.appendChild(warning);
            
            return false;
        } else {
            input.style.borderColor = '';
            input.style.backgroundColor = '';
            
            // Remover aviso se existir
            let existingWarning = input.parentNode.querySelector('.length-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            return true;
        }
    }

    // Fun√ß√£o para calcular idade baseada na data de nascimento
    function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }
        
        return age;
    }

    // Fun√ß√£o para validar idade vs data nascimento
    function validateAge() {
        const idadeInput = document.querySelector('[name="idade"]');
        const dataNascInput = document.querySelector('[name="data_nascimento"]');
        
        if (idadeInput && dataNascInput && dataNascInput.value) {
            const calculatedAge = calculateAge(dataNascInput.value);
            const inputAge = parseInt(idadeInput.value);
            
            if (inputAge !== calculatedAge) {
                showFieldError(idadeInput, `Idade deve ser ${calculatedAge} anos baseada na data de nascimento`);
                return false;
            } else {
                clearFieldError(idadeInput);
                return true;
            }
        }
        return true;
    }

    // Fun√ß√£o para validar campos do companheiro
    function validateCompanheiro() {
        const estadoCivil = document.querySelector('[name="estado_civil"]');
        const companheiroCampos = [
            'nome_companheiro', 'cpf_companheiro', 'rg_companheiro', 
            'idade_companheiro', 'escolaridade_companheiro', 'profissao_companheiro',
            'data_nascimento_companheiro', 'titulo_companheiro', 'cidade_titulo_companheiro', 'nis_companheiro'
        ];
        
        if (estadoCivil && estadoCivil.value === 'Solteiro(a)') {
            // Desabilitar e limpar campos do companheiro
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = true;
                    input.value = '';
                    input.style.backgroundColor = '#f5f5f5';
                    clearFieldError(input);
                }
            });
            return true;
        } else if (estadoCivil && estadoCivil.value !== '') {
            // Habilitar campos e validar preenchimento
            let hasErrors = false;
            const camposObrigatorios = ['nome_companheiro', 'cpf_companheiro', 'rg_companheiro', 'idade_companheiro', 'escolaridade_companheiro', 'profissao_companheiro'];
            
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = false;
                    input.style.backgroundColor = '';
                }
            });
            
            camposObrigatorios.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input && !input.value.trim()) {
                    showFieldError(input, 'Campo obrigat√≥rio para n√£o solteiros');
                    hasErrors = true;
                } else if (input) {
                    clearFieldError(input);
                }
            });
            return !hasErrors;
        } else {
            // Habilitar campos se estado civil n√£o selecionado
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = false;
                    input.style.backgroundColor = '';
                    clearFieldError(input);
                }
            });
            return true;
        }
    }

    // Fun√ß√£o para validar soma da fam√≠lia
    function validateFamiliaSum() {
        const numPessoas = parseInt(document.querySelector('[name="num_pessoas_familia"]')?.value || 0);
        const adultos = parseInt(document.querySelector('[name="adultos"]')?.value || 0);
        const criancas = parseInt(document.querySelector('[name="criancas"]')?.value || 0);
        const adolescentes = parseInt(document.querySelector('[name="adolescentes"]')?.value || 0);
        const idosos = parseInt(document.querySelector('[name="idosos"]')?.value || 0);
        const gestantes = parseInt(document.querySelector('[name="gestantes"]')?.value || 0);
        const nutrizes = parseInt(document.querySelector('[name="nutrizes"]')?.value || 0);
        
        const soma = adultos + criancas + adolescentes + idosos + gestantes + nutrizes;
        const numPessoasInput = document.querySelector('[name="num_pessoas_familia"]');
        
        if (soma > numPessoas) {
            showFieldError(numPessoasInput, `Soma dos membros (${soma}) n√£o pode ser maior que o total (${numPessoas})`);
            return false;
        } else {
            clearFieldError(numPessoasInput);
            return true;
        }
    }

    // Fun√ß√£o para validar campos de sa√∫de obrigat√≥rios
    function validateSaude() {
        const validations = [
            { checkbox: 'tem_doenca_cronica', field: 'doencas_cronicas', label: 'Quais doen√ßas cr√¥nicas?' },
            { checkbox: 'usa_medicamento_continuo', field: 'medicamentos_continuos', label: 'Quais medicamentos?' },
            { checkbox: 'tem_doenca_mental', field: 'doencas_mentais', label: 'Quais doen√ßas mentais?' },
            { checkbox: 'tem_deficiencia', field: 'tipo_deficiencia', label: 'Tipo de defici√™ncia?' },
            { checkbox: 'precisa_cuidados_especiais', field: 'cuidados_especiais', label: 'Quais cuidados?' }
        ];
        
        let hasErrors = false;
        validations.forEach(validation => {
            const checkbox = document.querySelector(`[name="${validation.checkbox}"]`);
            const field = document.querySelector(`[name="${validation.field}"]`);
            
            if (checkbox && field && checkbox.value === 'Sim' && !field.value.trim()) {
                showFieldError(field, `${validation.label} √© obrigat√≥rio quando marcado como "Sim"`);
                hasErrors = true;
            } else if (field) {
                clearFieldError(field);
            }
        });
        
        return !hasErrors;
    }

    // Fun√ß√£o para validar campos "Outro" obrigat√≥rios
    function validateOutroFields() {
        const validations = [
            { checkbox: 'trabalho_incomoda_outro', field: 'trabalho_incomoda_outro_desc', label: 'Especifique o que incomoda no trabalho' },
            { checkbox: 'fonte_renda_outro', field: 'fonte_renda_outro_desc', label: 'Especifique a outra fonte de renda' }
        ];
        
        let hasErrors = false;
        validations.forEach(validation => {
            const checkbox = document.querySelector(`[name="${validation.checkbox}"]`);
            const field = document.querySelector(`[name="${validation.field}"]`);
            
            if (checkbox && field && checkbox.value === 'Sim' && !field.value.trim()) {
                showFieldError(field, `${validation.label} √© obrigat√≥rio quando marcado como "Sim"`);
                hasErrors = true;
            } else if (field) {
                clearFieldError(field);
            }
        });
        
        return !hasErrors;
    }
    function validateHorario() {
        const horarioInput = document.querySelector('[name="horario_trabalho"]');
        if (horarioInput && horarioInput.value) {
            const horarioRegex = /^\d{2}:\d{2}\s*a\s*\d{2}:\d{2}$/i;
            if (!horarioRegex.test(horarioInput.value)) {
                showFieldError(horarioInput, 'Formato deve ser HH:MM a HH:MM (ex: 08:00 a 17:00)');
                return false;
            } else {
                clearFieldError(horarioInput);
                return true;
            }
        }
        return true;
    }

    // Fun√ß√£o para mostrar erro no campo
    function showFieldError(input, message) {
        input.style.borderColor = '#dc3545';
        input.style.backgroundColor = '#fff5f5';
        
        let existingError = input.parentNode.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
        
        const error = document.createElement('div');
        error.className = 'validation-error';
        error.style.color = '#dc3545';
        error.style.fontSize = '12px';
        error.style.marginTop = '2px';
        error.textContent = message;
        input.parentNode.appendChild(error);
    }

    // Fun√ß√£o para limpar erro do campo
    function clearFieldError(input) {
        input.style.borderColor = '';
        input.style.backgroundColor = '';
        
        let existingError = input.parentNode.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
    }

    // Adicionar valida√ß√£o em tempo real para todos os campos com limite
    document.addEventListener('DOMContentLoaded', function() {
        Object.keys(FIELD_LIMITS).forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('input', function() {
                    validateField(this);
                });
                
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            }
        });

        // Valida√ß√£o idade vs data nascimento
        const idadeInput = document.querySelector('[name="idade"]');
        const dataNascInput = document.querySelector('[name="data_nascimento"]');
        
        if (idadeInput && dataNascInput) {
            dataNascInput.addEventListener('change', function() {
                if (this.value) {
                    const calculatedAge = calculateAge(this.value);
                    // Remover temporariamente o listener para evitar loop
                    idadeInput.removeEventListener('input', validateAge);
                    idadeInput.value = calculatedAge;
                    // Reativar o listener ap√≥s um pequeno delay
                    setTimeout(() => {
                        idadeInput.addEventListener('input', validateAge);
                    }, 100);
                }
                validateAge();
            });
            
            idadeInput.addEventListener('input', validateAge);
        }

        // Valida√ß√£o estado civil vs companheiro
        const estadoCivilInput = document.querySelector('[name="estado_civil"]');
        if (estadoCivilInput) {
            estadoCivilInput.addEventListener('change', validateCompanheiro);
            // Validar estado inicial
            validateCompanheiro();
        }

        // Valida√ß√£o soma fam√≠lia
        const familiaInputs = ['num_pessoas_familia', 'adultos', 'criancas', 'adolescentes', 'idosos', 'gestantes', 'nutrizes'];
        familiaInputs.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('input', validateFamiliaSum);
            }
        });

        // Valida√ß√£o campos sa√∫de
        const saudeCheckboxes = ['tem_doenca_cronica', 'usa_medicamento_continuo', 'tem_doenca_mental', 'tem_deficiencia', 'precisa_cuidados_especiais'];
        saudeCheckboxes.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('change', validateSaude);
            }
        });

        // Valida√ß√£o campos "Outro"
        const outroCheckboxes = ['trabalho_incomoda_outro', 'fonte_renda_outro'];
        outroCheckboxes.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('change', validateOutroFields);
            }
        });

        // Valida√ß√£o hor√°rio trabalho
        const horarioInput = document.querySelector('[name="horario_trabalho"]');
        if (horarioInput) {
            horarioInput.addEventListener('blur', validateHorario);
        }
        
        // Valida√ß√£o no envio do formul√°rio
        document.querySelector('form').addEventListener('submit', function(e) {
            let hasErrors = false;
            
            // Validar limites de caracteres
            Object.keys(FIELD_LIMITS).forEach(fieldName => {
                const input = document.querySelector(`[name="${fieldName}"]`);
                if (input && !validateField(input)) {
                    hasErrors = true;
                }
            });
            
            // Validar regras de neg√≥cio
            if (!validateAge()) hasErrors = true;
            if (!validateCompanheiro()) hasErrors = true;
            if (!validateFamiliaSum()) hasErrors = true;
            if (!validateSaude()) hasErrors = true;
            if (!validateOutroFields()) hasErrors = true;
            if (!validateHorario()) hasErrors = true;
            
            if (hasErrors) {
                e.preventDefault();
                alert('Por favor, corrija os campos destacados antes de enviar o formul√°rio.');
                return false;
            }
        });
    });
    </script>
</body>
</html>
