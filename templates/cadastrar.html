<!DOCTYPE html>
<html>
<head>
    <title>AMEG - Novo Cadastro</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/mobile.css">
    <style>
        body { font-family: Arial; margin: 0; background: #f4f4f4; }
        .header { background: #2c3e50; color: white; padding: 20px; }
        .nav { background: #34495e; padding: 15px; }
        .nav a { color: white; text-decoration: none; padding: 10px 20px; margin-right: 10px; background: #3498db; border-radius: 5px; }
        .container { padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        .form-group { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn { background: #27ae60; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #229954; }
        .logout { float: right; color: white; text-decoration: none; }
        
        /* Estilos para bot√µes de foto */
        .photo-controls .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
        }
        
        #photoPlaceholder:hover {
            border-color: #3498db !important;
            background: linear-gradient(135deg, #d5dbdb 0%, #a6acaf 100%) !important;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AMEG - Novo Cadastro</h1>
        <a href="/logout" class="logout">Sair</a>
    </div>
    
    <div class="nav">
        <a href="/dashboard">Dashboard</a>
        <a href="/cadastrar">Novo Cadastro</a>
        <a href="/relatorios">Relat√≥rios</a>
        <a href="/exportar">Exportar CSV</a>
    </div>
    
    <div class="container">
        <div class="form-card">
            <h2 style="text-align: center;">Cadastro Familiar</h2>
            
            <!-- Campo de Foto 3x4 - Centralizado -->
            <div style="text-align: center; margin: 20px 0;">
                <div class="photo-capture" style="display: inline-block; background: #f8f9fa; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="photo-preview" style="margin-bottom: 10px;">
                        <canvas id="photoCanvas" width="120" height="160" style="border: 2px solid #3498db; border-radius: 8px; display: none; box-shadow: 0 1px 5px rgba(0,0,0,0.1);"></canvas>
                        <div id="photoPlaceholder" style="width: 120px; height: 160px; border: 2px dashed #bdc3c7; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%); color: #7f8c8d; cursor: pointer; transition: all 0.3s ease; font-size: 10px; text-align: center; padding: 10px; box-sizing: border-box;">
                            <div>
                                <div style="font-size: 24px; margin-bottom: 5px;">üì∏</div>
                                <div style="font-weight: bold; font-size: 9px;">Foto 3x4</div>
                            </div>
                        </div>
                    </div>
                    <div class="photo-controls" style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                        <button type="button" id="startCamera" class="btn" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 6px 8px; border-radius: 6px; font-size: 10px; cursor: pointer; transition: all 0.3s ease;">
                            üì∑
                        </button>
                        <button type="button" id="capturePhoto" class="btn" style="background: linear-gradient(135deg, #27ae60, #229954); color: white; border: none; padding: 6px 8px; border-radius: 6px; font-size: 10px; cursor: pointer; transition: all 0.3s ease; display: none;">
                            üì∏
                        </button>
                        <button type="button" id="retakePhoto" class="btn" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 6px 8px; border-radius: 6px; font-size: 10px; cursor: pointer; transition: all 0.3s ease; display: none;">
                            üîÑ
                        </button>
                        <button type="button" id="uploadBtn" class="btn" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; border: none; padding: 6px 8px; border-radius: 6px; font-size: 10px; cursor: pointer; transition: all 0.3s ease;">
                            üìÅ
                        </button>
                    </div>
                    <video id="cameraVideo" width="120" height="160" autoplay style="display: none; border: 2px solid #27ae60; border-radius: 8px;"></video>
                    <input type="file" id="uploadPhoto" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="foto_base64" id="fotoBase64">
                <h3 style="text-align: center;">1. DADOS DO TITULAR</h3>
                
                <div class="form-group">
                    <label>Nome Completo *</label>
                    <input type="text" name="nome_completo" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Endere√ßo *</label>
                        <input type="text" name="endereco" required readonly>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero *</label>
                        <input type="text" name="numero" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Bairro *</label>
                        <input type="text" name="bairro" required readonly>
                    </div>
                    <div class="form-group">
                        <label>CEP * <small>(preenche endere√ßo automaticamente)</small></label>
                        <input type="text" name="cep" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Cidade *</label>
                        <input type="text" name="cidade" required readonly>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <input type="text" name="estado" required maxlength="2" placeholder="PB" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Telefone Celular *</label>
                        <input type="text" name="telefone" required>
                    </div>
                    <div class="form-group">
                        <label>Ponto de Refer√™ncia</label>
                        <input type="text" name="ponto_referencia">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>G√™nero *</label>
                        <select name="genero" required>
                            <option value="">Selecione</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Cisg√™nero">Cisg√™nero</option>
                            <option value="Homem cis">Homem cis</option>
                            <option value="Mulher cis">Mulher cis</option>
                            <option value="Transg√™nero">Transg√™nero</option>
                            <option value="Homem trans">Homem trans</option>
                            <option value="Mulher trans">Mulher trans</option>
                            <option value="Travesti">Travesti</option>
                            <option value="N√£o-bin√°rio">N√£o-bin√°rio</option>
                            <option value="G√™nero fluido">G√™nero fluido</option>
                            <option value="Ag√™nero">Ag√™nero</option>
                            <option value="Big√™nero">Big√™nero</option>
                            <option value="Polig√™nero">Polig√™nero</option>
                            <option value="Pang√™nero">Pang√™nero</option>
                            <option value="Demig√™nero">Demig√™nero</option>
                            <option value="Demi-boy">Demi-boy</option>
                            <option value="Demi-girl">Demi-girl</option>
                            <option value="Andr√≥gino">Andr√≥gino</option>
                            <option value="Interg√™nero">Interg√™nero</option>
                            <option value="Neutrois">Neutrois</option>
                            <option value="Two-Spirit">Two-Spirit</option>
                            <option value="Queer">Queer</option>
                            <option value="G√™nero n√£o-conforme">G√™nero n√£o-conforme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Idade *</label>
                        <input type="number" name="idade" required>
                    </div>
                    <div class="form-group">
                        <label>Data Nascimento *</label>
                        <input type="date" name="data_nascimento" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∫ T√≠tulo de Eleitor</label>
                        <input type="text" name="titulo_eleitor">
                    </div>
                    <div class="form-group">
                        <label>Cidade Emiss√£o T√≠tulo</label>
                        <input type="text" name="cidade_titulo">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>CPF *</label>
                        <input type="text" name="cpf" required>
                    </div>
                    <div class="form-group">
                        <label>RG *</label>
                        <input type="text" name="rg" required>
                    </div>
                    <div class="form-group">
                        <label>NIS</label>
                        <input type="text" name="nis">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Estado Civil *</label>
                        <select name="estado_civil" required>
                            <option value="">Selecione</option>
                            <option value="Solteiro(a)">Solteiro(a)</option>
                            <option value="Casado(a)">Casado(a)</option>
                            <option value="Separado(a) judicialmente">Separado(a) judicialmente</option>
                            <option value="Divorciado(a)">Divorciado(a)</option>
                            <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
                            <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Escolaridade *</label>
                        <select name="escolaridade" required>
                            <option value="">Selecione...</option>
                            <option value="Analfabeto">Analfabeto</option>
                            <option value="Educa√ß√£o Infantil">Educa√ß√£o Infantil</option>
                            <option value="Ensino Fundamental">Ensino Fundamental</option>
                            <option value="Ensino M√©dio">Ensino M√©dio</option>
                            <option value="Gradua√ß√£o Bacharelado">Gradua√ß√£o Bacharelado</option>
                            <option value="Gradua√ß√£o Licenciatura">Gradua√ß√£o Licenciatura</option>
                            <option value="Gradua√ß√£o Tecnol√≥gico">Gradua√ß√£o Tecnol√≥gico</option>
                            <option value="P√≥s-gradua√ß√£o Lato sensu">P√≥s-gradua√ß√£o Lato sensu</option>
                            <option value="P√≥s-gradua√ß√£o Stricto sensu">P√≥s-gradua√ß√£o Stricto sensu</option>
                            <option value="Educa√ß√£o de Jovens e Adultos (EJA)">Educa√ß√£o de Jovens e Adultos (EJA)</option>
                            <option value="Educa√ß√£o Profissional e Tecnol√≥gica (EPT)">Educa√ß√£o Profissional e Tecnol√≥gica (EPT)</option>
                            <option value="Educa√ß√£o Especial">Educa√ß√£o Especial</option>
                            <option value="Educa√ß√£o Ind√≠gena">Educa√ß√£o Ind√≠gena</option>
                            <option value="Educa√ß√£o do Campo">Educa√ß√£o do Campo</option>
                            <option value="Educa√ß√£o Quilombola">Educa√ß√£o Quilombola</option>
                            <option value="Educa√ß√£o a Dist√¢ncia (EaD)">Educa√ß√£o a Dist√¢ncia (EaD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profiss√£o *</label>
                        <input type="text" name="profissao" required>
                    </div>
                </div>
                
                <h3>DADOS DO COMPANHEIRO</h3>
                
                <div class="form-group">
                    <label>Nome Companheiro</label>
                    <input type="text" name="nome_companheiro">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>CPF Companheiro</label>
                        <input type="text" name="cpf_companheiro">
                    </div>
                    <div class="form-group">
                        <label>RG Companheiro</label>
                        <input type="text" name="rg_companheiro">
                    </div>
                    <div class="form-group">
                        <label>Idade Companheiro</label>
                        <input type="number" name="idade_companheiro">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>T√≠tulo Eleitor Companheiro</label>
                        <input type="text" name="titulo_companheiro">
                    </div>
                    <div class="form-group">
                        <label>Cidade T√≠tulo Companheiro</label>
                        <input type="text" name="cidade_titulo_companheiro">
                    </div>
                    <div class="form-group">
                        <label>NIS Companheiro</label>
                        <input type="text" name="nis_companheiro">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Escolaridade Companheiro</label>
                        <select name="escolaridade_companheiro">
                            <option value="">Selecione...</option>
                            <option value="Analfabeto">Analfabeto</option>
                            <option value="Educa√ß√£o Infantil">Educa√ß√£o Infantil</option>
                            <option value="Ensino Fundamental">Ensino Fundamental</option>
                            <option value="Ensino M√©dio">Ensino M√©dio</option>
                            <option value="Gradua√ß√£o Bacharelado">Gradua√ß√£o Bacharelado</option>
                            <option value="Gradua√ß√£o Licenciatura">Gradua√ß√£o Licenciatura</option>
                            <option value="Gradua√ß√£o Tecnol√≥gico">Gradua√ß√£o Tecnol√≥gico</option>
                            <option value="P√≥s-gradua√ß√£o Lato sensu">P√≥s-gradua√ß√£o Lato sensu</option>
                            <option value="P√≥s-gradua√ß√£o Stricto sensu">P√≥s-gradua√ß√£o Stricto sensu</option>
                            <option value="Educa√ß√£o de Jovens e Adultos (EJA)">Educa√ß√£o de Jovens e Adultos (EJA)</option>
                            <option value="Educa√ß√£o Profissional e Tecnol√≥gica (EPT)">Educa√ß√£o Profissional e Tecnol√≥gica (EPT)</option>
                            <option value="Educa√ß√£o Especial">Educa√ß√£o Especial</option>
                            <option value="Educa√ß√£o Ind√≠gena">Educa√ß√£o Ind√≠gena</option>
                            <option value="Educa√ß√£o do Campo">Educa√ß√£o do Campo</option>
                            <option value="Educa√ß√£o Quilombola">Educa√ß√£o Quilombola</option>
                            <option value="Educa√ß√£o a Dist√¢ncia (EaD)">Educa√ß√£o a Dist√¢ncia (EaD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profiss√£o Companheiro</label>
                        <input type="text" name="profissao_companheiro">
                    </div>
                    <div class="form-group">
                        <label>Data Nascimento Companheiro</label>
                        <input type="date" name="data_nascimento_companheiro">
                    </div>
                </div>
                
                <h3>2. DADOS DE RENDA FAMILIAR</h3>
                
                <div class="form-group">
                    <label>Tipo de Trabalho</label>
                    <select name="tipo_trabalho">
                        <option value="">Selecione</option>
                        <option value="Assalariado com carteira">Assalariado com carteira</option>
                        <option value="Assalariado sem carteira">Assalariado sem carteira</option>
                        <option value="Trabalhador Aut√¥nomo">Trabalhador Aut√¥nomo</option>
                        <option value="Aposentado">Aposentado</option>
                        <option value="Pensionista">Pensionista</option>
                        <option value="BPC">BPC</option>
                        <option value="Funcion√°rio P√∫blico">Funcion√°rio P√∫blico</option>
                        <option value="Desempregado">Desempregado</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantas pessoas trabalham?</label>
                        <input type="number" name="pessoas_trabalham" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Quantos Aposentados/Pensionistas?</label>
                        <input type="number" name="aposentados_pensionistas" required min="0" value="0">
                    </div>
                </div>
                
                <h3>3. DETALHAMENTO FAMILIAR</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∫ Pessoas na Fam√≠lia</label>
                        <input type="number" name="num_pessoas_familia" required min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>N¬∫ de Fam√≠lias</label>
                        <select name="num_familias">
                            <option value="">Selecione</option>
                            <option value="1">1 Fam√≠lia</option>
                            <option value="2">2 Fam√≠lias</option>
                            <option value="3">Mais de 2 fam√≠lias</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Adultos</label>
                        <input type="number" name="adultos" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Crian√ßas</label>
                        <input type="number" name="criancas" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Adolescentes</label>
                        <input type="number" name="adolescentes" required min="0" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Idosos</label>
                        <input type="number" name="idosos" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Gestantes</label>
                        <input type="number" name="gestantes" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Nutrizes</label>
                        <input type="number" name="nutrizes" required min="0" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Renda Familiar Bruta (R$) *</label>
                        <input type="number" step="0.01" name="renda_familiar" required min="0.01" placeholder="Digite a renda familiar">
                    </div>
                    <div class="form-group">
                        <label>Renda Per Capita (R$) *</label>
                        <input type="number" step="0.01" name="renda_per_capita" required min="0.01" placeholder="Digite a renda per capita">
                    </div>
                    <div class="form-group">
                        <label>Bolsa Fam√≠lia (R$)</label>
                        <input type="number" step="0.01" name="bolsa_familia" required min="0" value="0">
                    </div>
                </div>
                
                <h3>DADOS DA MORADIA</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Casa</label>
                        <select name="casa_tipo">
                            <option value="">Selecione</option>
                            <option value="pr√≥pria">Pr√≥pria</option>
                            <option value="alugada">Alugada</option>
                            <option value="cedida">Cedida</option>
                            <option value="invadida">Invadida</option>
                            <option value="compartilhada">Compartilhada</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo Material</label>
                        <select name="casa_material">
                            <option value="">Selecione</option>
                            <option value="alvenaria">Alvenaria</option>
                            <option value="mista">Mista</option>
                            <option value="taipa">Taipa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Energia</label>
                        <select name="energia">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Lixo</label>
                        <select name="lixo">
                            <option value="">Selecione</option>
                            <option value="coletado">Coletado</option>
                            <option value="queimado">Queimado</option>
                            <option value="enterrado">Enterrado</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√Ågua</label>
                        <select name="agua">
                            <option value="">Selecione</option>
                            <option value="encanada">Encanada</option>
                            <option value="po√ßo">Po√ßo</option>
                            <option value="cisterna">Cisterna</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Esgoto</label>
                        <select name="esgoto">
                            <option value="">Selecione</option>
                            <option value="saneado">Saneado</option>
                            <option value="fossa">Fossa</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea name="observacoes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                </div>
                
                <h3>DADOS DA SA√öDE DA FAM√çLIA</h3>
                
                <div id="dados-saude-container">
                    <div class="pessoa-saude" data-pessoa="1">
                        <div class="pessoa-header">
                            <h4>Pessoa 1</h4>
                            <button type="button" class="btn-remove-pessoa" onclick="removePessoa(1)" style="display:none;">‚ùå</button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome da pessoa:</label>
                                <input type="text" name="saude_nome_1" placeholder="Nome completo" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Condi√ß√µes de sa√∫de:</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="doenca_cronica_1" name="saude_condicoes_1[]" value="doenca_cronica" onchange="toggleEspecificacao(this, 'spec_doenca_cronica_1')">
                                        <label for="doenca_cronica_1">Tem doen√ßa cr√¥nica?</label>
                                        <input type="text" id="spec_doenca_cronica_1" name="saude_doencas_cronicas_1" placeholder="Especificar doen√ßas cr√¥nicas" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="medicamento_1" name="saude_condicoes_1[]" value="medicamento" onchange="toggleEspecificacao(this, 'spec_medicamento_1')" disabled style="opacity: 0.5;">
                                        <label for="medicamento_1" style="opacity: 0.5;">Usa medicamento cont√≠nuo?</label>
                                        <input type="text" id="spec_medicamento_1" name="saude_medicamentos_1" placeholder="Especificar medicamentos" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="doenca_mental_1" name="saude_condicoes_1[]" value="doenca_mental" onchange="toggleEspecificacao(this, 'spec_doenca_mental_1')">
                                        <label for="doenca_mental_1">Tem doen√ßa mental?</label>
                                        <input type="text" id="spec_doenca_mental_1" name="saude_doencas_mentais_1" placeholder="Especificar doen√ßas mentais" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="deficiencia_1" name="saude_condicoes_1[]" value="deficiencia" onchange="toggleEspecificacao(this, 'spec_deficiencia_1')">
                                        <label for="deficiencia_1">Tem defici√™ncia?</label>
                                        <input type="text" id="spec_deficiencia_1" name="saude_deficiencias_1" placeholder="Especificar defici√™ncias" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cuidados_1" name="saude_condicoes_1[]" value="cuidados" onchange="toggleEspecificacao(this, 'spec_cuidados_1')">
                                        <label for="cuidados_1">Precisa de cuidados especiais?</label>
                                        <input type="text" id="spec_cuidados_1" name="saude_cuidados_especiais_1" placeholder="Especificar cuidados necess√°rios" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="button" class="btn-add-pessoa" onclick="addPessoa()">‚ûï Adicionar outra pessoa</button>
                </div>
                
                <script>
                let contadorPessoas = 1;
                
                function toggleEspecificacao(checkbox, targetId) {
                    const target = document.getElementById(targetId);
                    const pessoaNum = checkbox.id.split('_').pop();
                    
                    if (checkbox.checked) {
                        target.disabled = false;
                        target.required = true;
                    } else {
                        target.disabled = true;
                        target.required = false;
                        target.value = '';
                    }
                    
                    // Se n√£o for o campo medicamento, verificar disponibilidade do medicamento
                    if (!checkbox.id.includes('medicamento')) {
                        toggleMedicamentoDisponibilidade(pessoaNum);
                    }
                }
                
                // Fun√ß√£o para controlar habilita√ß√£o do campo medicamento
                function toggleMedicamentoDisponibilidade(pessoaNum) {
                    const doencaCronica = document.getElementById(`doenca_cronica_${pessoaNum}`);
                    const doencaMental = document.getElementById(`doenca_mental_${pessoaNum}`);
                    const deficiencia = document.getElementById(`deficiencia_${pessoaNum}`);
                    const cuidados = document.getElementById(`cuidados_${pessoaNum}`);
                    const medicamento = document.getElementById(`medicamento_${pessoaNum}`);
                    const specMedicamento = document.getElementById(`spec_medicamento_${pessoaNum}`);
                    
                    // Verificar se alguma das outras condi√ß√µes est√° marcada
                    const algumaMarcada = doencaCronica.checked || doencaMental.checked || deficiencia.checked || cuidados.checked;
                    
                    if (algumaMarcada) {
                        // Habilitar medicamento
                        medicamento.disabled = false;
                        medicamento.parentElement.style.opacity = '1';
                    } else {
                        // Desabilitar medicamento e limpar
                        medicamento.disabled = true;
                        medicamento.checked = false;
                        medicamento.parentElement.style.opacity = '0.5';
                        specMedicamento.disabled = true;
                        specMedicamento.value = '';
                    }
                }
                
                function addPessoa() {
                    contadorPessoas++;
                    const container = document.getElementById('dados-saude-container');
                    
                    const novaPessoa = document.createElement('div');
                    novaPessoa.className = 'pessoa-saude';
                    novaPessoa.setAttribute('data-pessoa', contadorPessoas);
                    
                    novaPessoa.innerHTML = `
                        <div class="pessoa-header">
                            <h4>Pessoa ${contadorPessoas}</h4>
                            <button type="button" class="btn-remove-pessoa" onclick="removePessoa(${contadorPessoas})">‚ùå</button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome da pessoa:</label>
                                <input type="text" name="saude_nome_${contadorPessoas}" placeholder="Nome completo" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Condi√ß√µes de sa√∫de:</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="doenca_cronica_${contadorPessoas}" name="saude_condicoes_${contadorPessoas}[]" value="doenca_cronica" onchange="toggleEspecificacao(this, 'spec_doenca_cronica_${contadorPessoas}')">
                                        <label for="doenca_cronica_${contadorPessoas}">Tem doen√ßa cr√¥nica?</label>
                                        <input type="text" id="spec_doenca_cronica_${contadorPessoas}" name="saude_doencas_cronicas_${contadorPessoas}" placeholder="Especificar doen√ßas cr√¥nicas" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="medicamento_${contadorPessoas}" name="saude_condicoes_${contadorPessoas}[]" value="medicamento" onchange="toggleEspecificacao(this, 'spec_medicamento_${contadorPessoas}')" disabled style="opacity: 0.5;">
                                        <label for="medicamento_${contadorPessoas}" style="opacity: 0.5;">Usa medicamento cont√≠nuo?</label>
                                        <input type="text" id="spec_medicamento_${contadorPessoas}" name="saude_medicamentos_${contadorPessoas}" placeholder="Especificar medicamentos" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="doenca_mental_${contadorPessoas}" name="saude_condicoes_${contadorPessoas}[]" value="doenca_mental" onchange="toggleEspecificacao(this, 'spec_doenca_mental_${contadorPessoas}')">
                                        <label for="doenca_mental_${contadorPessoas}">Tem doen√ßa mental?</label>
                                        <input type="text" id="spec_doenca_mental_${contadorPessoas}" name="saude_doencas_mentais_${contadorPessoas}" placeholder="Especificar doen√ßas mentais" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="deficiencia_${contadorPessoas}" name="saude_condicoes_${contadorPessoas}[]" value="deficiencia" onchange="toggleEspecificacao(this, 'spec_deficiencia_${contadorPessoas}')">
                                        <label for="deficiencia_${contadorPessoas}">Tem defici√™ncia?</label>
                                        <input type="text" id="spec_deficiencia_${contadorPessoas}" name="saude_deficiencias_${contadorPessoas}" placeholder="Especificar defici√™ncias" disabled>
                                    </div>
                                    
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cuidados_${contadorPessoas}" name="saude_condicoes_${contadorPessoas}[]" value="cuidados" onchange="toggleEspecificacao(this, 'spec_cuidados_${contadorPessoas}')">
                                        <label for="cuidados_${contadorPessoas}">Precisa de cuidados especiais?</label>
                                        <input type="text" id="spec_cuidados_${contadorPessoas}" name="saude_cuidados_especiais_${contadorPessoas}" placeholder="Especificar cuidados necess√°rios" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(novaPessoa);
                    
                    // Mostrar bot√£o de remover da primeira pessoa se houver mais de uma
                    if (contadorPessoas > 1) {
                        document.querySelector('[data-pessoa="1"] .btn-remove-pessoa').style.display = 'inline-block';
                    }
                }
                
                function removePessoa(numero) {
                    const pessoa = document.querySelector(`[data-pessoa="${numero}"]`);
                    if (pessoa) {
                        pessoa.remove();
                        
                        // Esconder bot√£o de remover da primeira pessoa se s√≥ sobrar ela
                        const pessoas = document.querySelectorAll('.pessoa-saude');
                        if (pessoas.length === 1) {
                            document.querySelector('[data-pessoa="1"] .btn-remove-pessoa').style.display = 'none';
                        }
                    }
                }
                </script>
                
                <style>
                .pessoa-saude {
                    border: 2px solid #e0e0e0;
                    border-radius: 10px;
                    padding: 20px;
                    margin-bottom: 20px;
                    background-color: #f9f9f9;
                }
                
                .pessoa-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                    border-bottom: 1px solid #ddd;
                    padding-bottom: 10px;
                }
                
                .pessoa-header h4 {
                    margin: 0;
                    color: #2c3e50;
                }
                
                .checkbox-group {
                    display: flex;
                    flex-direction: column;
                    gap: 2px;
                }
                
                .checkbox-item {
                    display: flex;
                    align-items: center;
                    gap: 3px;
                    padding: 2px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    background: white;
                }
                
                .checkbox-item input[type="checkbox"] {
                    margin: 0;
                    flex-shrink: 0;
                    width: 14px;
                    height: 14px;
                }
                
                .checkbox-item label {
                    width: 130px;
                    margin: 0;
                    font-weight: bold;
                    font-size: 12px;
                    flex-shrink: 0;
                    color: #2c3e50;
                }
                
                .checkbox-item input[type="text"] {
                    flex: 1;
                    width: 100%;
                    padding: 6px 8px;
                    border: 1px solid #ccc;
                    border-radius: 3px;
                    font-size: 12px;
                }
                
                .btn-add-pessoa, .btn-remove-pessoa {
                    background: #3498db;
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 14px;
                }
                
                .btn-add-pessoa:hover, .btn-remove-pessoa:hover {
                    background: #2980b9;
                }
                
                .btn-remove-pessoa {
                    background: #e74c3c;
                    padding: 5px 10px;
                }
                
                .btn-remove-pessoa:hover {
                    background: #c0392b;
                }
                </style>
                
                <h3>ANEXOS DE SA√öDE</h3>
                <p style="color: #666; font-size: 14px;">Anexe laudos m√©dicos, receitas ou imagens relacionadas √† sa√∫de (PDF, PNG, JPG, DOC - m√°x. 16MB cada)</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üìã Laudo M√©dico</label>
                        <button type="button" onclick="addFileInput('laudo')" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-bottom: 10px;">+ Adicionar Laudo</button>
                        <div id="laudo-list"></div>
                    </div>
                    <div class="form-group">
                        <label>üíä Receita M√©dica</label>
                        <button type="button" onclick="addFileInput('receita')" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-bottom: 10px;">+ Adicionar Receita</button>
                        <div id="receita-list"></div>
                    </div>
                    <div class="form-group">
                        <label>üì∑ Imagem/Exame</label>
                        <button type="button" onclick="addFileInput('imagem')" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-bottom: 10px;">+ Adicionar Imagem</button>
                        <div id="imagem-list"></div>
                    </div>
                </div>
                
                <script>
                function toggleField(select, targetId) {
                    const target = document.getElementById(targetId);
                    if (select.value === 'Sim') {
                        target.disabled = false;
                        target.style.backgroundColor = '#fff';
                    } else {
                        target.disabled = true;
                        target.value = '';
                        target.style.backgroundColor = '#f5f5f5';
                    }
                }

                // Contadores para IDs √∫nicos
                let fileCounters = { laudo: 0, receita: 0, imagem: 0 };

                function addFileInput(type) {
                    const counter = ++fileCounters[type];
                    const listDiv = document.getElementById(type + '-list');
                    
                    const fileDiv = document.createElement('div');
                    fileDiv.id = type + '-item-' + counter;
                    fileDiv.style.cssText = 'border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; background: #f9f9f9;';
                    
                    fileDiv.innerHTML = `
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 5px;">
                            <span style="font-weight: bold;">${type.charAt(0).toUpperCase() + type.slice(1)} ${counter}</span>
                            <button type="button" onclick="removeFileInput('${type}', ${counter})" 
                                    style="background: #dc3545; color: white; border: none; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: auto;">
                                ‚úï Excluir
                            </button>
                        </div>
                        <input type="file" name="${type}[]" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx" style="margin-bottom: 5px; width: 100%;">
                        <input type="text" name="descricao_${type}[]" placeholder="Descri√ß√£o (opcional)" style="width: 100%;">
                    `;
                    
                    listDiv.appendChild(fileDiv);
                }

                function removeFileInput(type, counter) {
                    const fileDiv = document.getElementById(type + '-item-' + counter);
                    if (fileDiv) {
                        fileDiv.remove();
                    }
                }
                
                </script>
                
                <script>
                // Formata√ß√£o e valida√ß√£o de CPF
                function formatCPF(input) {
                    let value = input.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                function validarCPF(cpf) {
                    cpf = cpf.replace(/[^\d]+/g, '');
                    if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
                    
                    let soma = 0;
                    for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i);
                    let resto = (soma * 10) % 11;
                    if (resto === 10 || resto === 11) resto = 0;
                    if (resto !== parseInt(cpf.charAt(9))) return false;
                    
                    soma = 0;
                    for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i);
                    resto = (soma * 10) % 11;
                    if (resto === 10 || resto === 11) resto = 0;
                    return resto === parseInt(cpf.charAt(10));
                }
                
                function validarCPFInput(input) {
                    const cpf = input.value.replace(/[^\d]+/g, '');
                    if (cpf.length === 11 && !validarCPF(cpf)) {
                        input.setCustomValidity('CPF inv√°lido');
                        input.style.borderColor = '#e74c3c';
                    } else {
                        input.setCustomValidity('');
                        input.style.borderColor = '#ddd';
                    }
                }
                
                // Formata√ß√£o de telefone
                function formatTelefone(input) {
                    let value = input.value.replace(/\D/g, '');
                    if (value.length <= 11) {
                        value = value.replace(/(\d{2})(\d)/, '($1) $2');
                        value = value.replace(/(\d{4})(\d)/, '$1-$2');
                    }
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                // Formata√ß√£o de CEP
                function formatCEP(input) {
                    let value = input.value.replace(/\D/g, '');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                    // S√≥ atualizar se o valor mudou para evitar loop
                    if (input.value !== value) {
                        input.value = value;
                    }
                }
                
                // Buscar endere√ßo pelo CEP
                function buscarCEP(cep) {
                    const cepLimpo = cep.replace(/\D/g, '');
                    
                    // Validar formato do CEP
                    if (cepLimpo.length !== 8) {
                        return; // N√£o buscar se CEP n√£o tem 8 d√≠gitos
                    }
                    
                    // Evitar m√∫ltiplas requisi√ß√µes para o mesmo CEP inv√°lido
                    if (window.lastInvalidCep === cepLimpo) {
                        return;
                    }
                    
                    fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.erro) {
                                // Habilitar campos de endere√ßo
                                document.querySelector('input[name="endereco"]').readOnly = false;
                                document.querySelector('input[name="bairro"]').readOnly = false;
                                document.querySelector('input[name="cidade"]').readOnly = false;
                                document.querySelector('input[name="estado"]').readOnly = false;
                                
                                // Preencher campos
                                document.querySelector('input[name="endereco"]').value = data.logradouro || '';
                                document.querySelector('input[name="bairro"]').value = data.bairro || '';
                                document.querySelector('input[name="cidade"]').value = data.localidade || '';
                                document.querySelector('input[name="estado"]').value = data.uf || '';
                                // Foca no campo n√∫mero ap√≥s preencher
                                document.querySelector('input[name="numero"]').focus();
                                // Limpar CEP inv√°lido anterior
                                window.lastInvalidCep = null;
                            } else {
                                // Marcar CEP como inv√°lido para evitar loop
                                window.lastInvalidCep = cepLimpo;
                                alert('CEP n√£o encontrado! Verifique o formato.');
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao buscar CEP:', error);
                            window.lastInvalidCep = cepLimpo;
                        });
                }
                
                // Aplicar formata√ß√£o aos campos CPF
                document.addEventListener('DOMContentLoaded', function() {
                    const cpfInputs = document.querySelectorAll('input[name="cpf"], input[name="cpf_companheiro"]');
                    cpfInputs.forEach(input => {
                        input.addEventListener('input', function() {
                            formatCPF(this);
                            validarCPFInput(this);
                        });
                        input.maxLength = 14;
                        input.pattern = '\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}';
                    });
                    
                    // Aplicar formata√ß√£o ao campo telefone
                    const telefoneInput = document.querySelector('input[name="telefone"]');
                    if (telefoneInput) {
                        telefoneInput.addEventListener('input', function() {
                            formatTelefone(this);
                        });
                        telefoneInput.maxLength = 15;
                        telefoneInput.placeholder = '(XX) XXXX-XXXX';
                    }
                    
                    // Aplicar formata√ß√£o ao campo CEP
                    const cepInput = document.querySelector('input[name="cep"]');
                    if (cepInput) {
                        cepInput.addEventListener('input', function() {
                            formatCEP(this);
                        });
                        cepInput.addEventListener('blur', function() {
                            const cepLimpo = this.value.replace(/\D/g, '');
                            // S√≥ buscar se CEP tem 8 d√≠gitos e n√£o foi buscado antes
                            if (cepLimpo.length === 8 && window.lastSearchedCep !== cepLimpo) {
                                window.lastSearchedCep = cepLimpo;
                                buscarCEP(this.value);
                            }
                        });
                        cepInput.maxLength = 10;
                        cepInput.placeholder = 'XXXXX-XX';
                    }
                });

                // Controlar campos do companheiro baseado no estado civil
                const estadoCivil = document.querySelector('select[name="estado_civil"]');
                const camposCompanheiro = ['idade_companheiro', 'data_nascimento_companheiro'];
                
                function toggleCamposCompanheiro() {
                    const isSolteiro = estadoCivil.value === 'Solteiro(a)';
                    camposCompanheiro.forEach(campo => {
                        const input = document.querySelector(`input[name="${campo}"]`);
                        if (input) {
                            if (isSolteiro) {
                                input.removeAttribute('required');
                                input.value = '';
                            } else {
                                input.setAttribute('required', 'required');
                            }
                        }
                    });
                }
                
                estadoCivil.addEventListener('change', toggleCamposCompanheiro);
                toggleCamposCompanheiro(); // Executar na carga da p√°gina
                </script>
                
                <!-- ATIVIDADE DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üìã Atividade de Trabalho</h3>
                
                <div class="form-group">
                    <label>Com o que voc√™ trabalha?</label>
                    <input type="text" name="com_que_trabalha">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Onde trabalha?</label>
                        <input type="text" name="onde_trabalha">
                    </div>
                    <div class="form-group">
                        <label>Localiza√ß√£o de trabalho</label>
                        <select name="localizacao_trabalho">
                            <option value="">Selecione</option>
                            <option value="Orla cedo">Orla cedo</option>
                            <option value="Orla noite">Orla noite</option>
                            <option value="Bessa">Bessa</option>
                            <option value="Centro">Centro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Qual √© o seu hor√°rio de trabalho?</label>
                        <input type="text" name="horario_trabalho" placeholder="08:00 a 17:00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>H√° quanto tempo atua nessa atividade?</label>
                        <input type="text" name="tempo_atividade">
                    </div>
                    <div class="form-group">
                        <label>Atua em ponto fixo?</label>
                        <select name="atua_ponto_fixo" onchange="toggleField(this, 'qual_ponto_fixo')">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Qual ponto?</label>
                    <input type="text" name="qual_ponto_fixo" id="qual_ponto_fixo" disabled>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantos dias por semana trabalha?</label>
                        <input type="number" name="dias_semana_trabalha" min="1" max="7">
                    </div>
                    <div class="form-group">
                        <label>Seu trabalho √© cont√≠nuo ou por temporada?</label>
                        <select name="trabalho_continuo_temporada">
                            <option value="">Selecione</option>
                            <option value="Cont√≠nuo">Cont√≠nuo</option>
                            <option value="Temporada">Por temporada</option>
                        </select>
                    </div>
                </div>
                
                <!-- CONDI√á√ïES DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">‚ö†Ô∏è Condi√ß√µes de Trabalho</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>J√° sofreu acidente no ambiente de trabalho?</label>
                        <select name="sofreu_acidente_trabalho" onchange="toggleField(this, 'qual_acidente')">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qual acidente?</label>
                        <input type="text" name="qual_acidente" id="qual_acidente" disabled>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>No seu trabalho, o que mais incomoda?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_calor" value="Sim" style="margin-right: 5px;"> Calor
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_barulho" value="Sim" style="margin-right: 5px;"> Barulho
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_seguranca" value="Sim" style="margin-right: 5px;"> Seguran√ßa
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_banheiros" value="Sim" style="margin-right: 5px;"> Aus√™ncia de banheiros
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="trabalho_incomoda_outro" value="Sim" style="margin-right: 5px;" onchange="toggleField(this, 'trabalho_incomoda_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="trabalho_incomoda_outro_desc" id="trabalho_incomoda_outro_desc" placeholder="Especifique" style="margin-top: 10px;" disabled>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Tem acesso a banheiro e √°gua pot√°vel durante o trabalho?</label>
                        <select name="acesso_banheiro_agua">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Costuma trabalhar sozinho(a) ou com ajudantes? Quantos?</label>
                        <input type="text" name="trabalha_sozinho_ajudantes">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Possui autoriza√ß√£o/licen√ßa municipal para atuar?</label>
                        <select name="possui_autorizacao_municipal">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Costuma ter problemas com fiscaliza√ß√£o ou viol√™ncia policial?</label>
                        <select name="problemas_fiscalizacao_policia">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                </div>
                
                <!-- ESTRUTURA DE TRABALHO -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üèóÔ∏è Estrutura de Trabalho</h3>
                
                <div class="form-group">
                    <label>Qual estrutura utiliza?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_barraca" value="Sim" style="margin-right: 5px;"> Barraca
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_carrinho" value="Sim" style="margin-right: 5px;"> Carrinho
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_mesa" value="Sim" style="margin-right: 5px;"> Mesa
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="estrutura_outro" value="Sim" style="margin-right: 5px;" onchange="toggleField(this, 'estrutura_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="estrutura_outro_desc" id="estrutura_outro_desc" placeholder="Especifique" style="margin-top: 10px;" disabled>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Necessita energia el√©trica?</label>
                        <select name="necessita_energia_eletrica">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Utiliza g√°s de cozinha?</label>
                        <select name="utiliza_gas_cozinha">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Usa ve√≠culo pr√≥prio para transporte?</label>
                        <select name="usa_veiculo_proprio" onchange="toggleField(this, 'qual_veiculo')">
                            <option value="">Selecione</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qual ve√≠culo?</label>
                        <input type="text" name="qual_veiculo" id="qual_veiculo" disabled>
                    </div>
                </div>
                
                <!-- RENDA E FAM√çLIA -->
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px;">üí∞ Renda e Fam√≠lia</h3>
                
                <div class="form-group">
                    <label>Qual √© a principal fonte de renda da sua fam√≠lia?</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_trabalho_ambulante" value="Sim" style="margin-right: 5px;"> Trabalho ambulante
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_aposentadoria" value="Sim" style="margin-right: 5px;"> Aposentadoria
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_beneficio_social" value="Sim" style="margin-right: 5px;"> Benef√≠cio social
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal;">
                            <input type="checkbox" name="fonte_renda_outro" value="Sim" style="margin-right: 5px;" onchange="toggleField(this, 'fonte_renda_outro_desc')"> Outro
                        </label>
                    </div>
                    <input type="text" name="fonte_renda_outro_desc" id="fonte_renda_outro_desc" placeholder="Especifique" style="margin-top: 10px;" disabled>
                </div>
                
                <div class="form-group">
                    <label>Quantas pessoas dependem diretamente da sua renda?</label>
                    <input type="number" name="pessoas_dependem_renda" min="0">
                </div>
                
                <button type="submit" class="btn">Salvar Cadastro</button>
            </form>
        </div>
    </div>

    <script>
    // Limites dos campos conforme definido na tabela do banco
    const FIELD_LIMITS = {
        'nome_completo': 255,
        'numero': 10,
        'bairro': 100,
        'cidade': 100,
        'estado': 2,
        'cep': 10,
        'telefone': 20,
        'titulo_eleitor': 20,
        'cidade_titulo': 100,
        'cpf': 14,
        'rg': 20,
        'nis': 20,
        'estado_civil': 30,
        'escolaridade': 100,
        'profissao': 100,
        'nome_companheiro': 255,
        'cpf_companheiro': 14,
        'rg_companheiro': 20,
        'escolaridade_companheiro': 100,
        'profissao_companheiro': 100,
        'titulo_companheiro': 20,
        'cidade_titulo_companheiro': 100,
        'nis_companheiro': 20,
        'tipo_trabalho': 100,
        'localizacao_trabalho': 50,
        'casa_tipo': 50,
        'casa_material': 50
    };

    // Fun√ß√£o para validar campo em tempo real
    function validateField(input) {
        const fieldName = input.name;
        const maxLength = FIELD_LIMITS[fieldName];
        
        if (maxLength && input.value.length > maxLength) {
            input.style.borderColor = '#dc3545';
            input.style.backgroundColor = '#fff5f5';
            
            // Remover aviso anterior se existir
            let existingWarning = input.parentNode.querySelector('.length-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            // Adicionar aviso
            const warning = document.createElement('div');
            warning.className = 'length-warning';
            warning.style.color = '#dc3545';
            warning.style.fontSize = '12px';
            warning.style.marginTop = '2px';
            warning.textContent = `M√°ximo ${maxLength} caracteres (atual: ${input.value.length})`;
            input.parentNode.appendChild(warning);
            
            return false;
        } else {
            input.style.borderColor = '';
            input.style.backgroundColor = '';
            
            // Remover aviso se existir
            let existingWarning = input.parentNode.querySelector('.length-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            return true;
        }
    }

    // Fun√ß√£o para calcular idade baseada na data de nascimento
    function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }
        
        return age;
    }

    // Fun√ß√£o para validar idade vs data nascimento
    function validateAge() {
        const idadeInput = document.querySelector('[name="idade"]');
        const dataNascInput = document.querySelector('[name="data_nascimento"]');
        
        if (idadeInput && dataNascInput && dataNascInput.value) {
            const calculatedAge = calculateAge(dataNascInput.value);
            const inputAge = parseInt(idadeInput.value);
            
            if (inputAge !== calculatedAge) {
                showFieldError(idadeInput, `Idade deve ser ${calculatedAge} anos baseada na data de nascimento`);
                return false;
            } else {
                clearFieldError(idadeInput);
                return true;
            }
        }
        return true;
    }

    // Fun√ß√£o para validar campos do companheiro
    function validateCompanheiro() {
        const estadoCivil = document.querySelector('[name="estado_civil"]');
        const companheiroCampos = [
            'nome_companheiro', 'cpf_companheiro', 'rg_companheiro', 
            'idade_companheiro', 'escolaridade_companheiro', 'profissao_companheiro',
            'data_nascimento_companheiro', 'titulo_companheiro', 'cidade_titulo_companheiro', 'nis_companheiro'
        ];
        
        if (estadoCivil && estadoCivil.value === 'Solteiro(a)') {
            // Desabilitar e limpar campos do companheiro
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = true;
                    input.value = '';
                    input.style.backgroundColor = '#f5f5f5';
                    clearFieldError(input);
                }
            });
            return true;
        } else if (estadoCivil && estadoCivil.value !== '') {
            // Habilitar campos e validar preenchimento
            let hasErrors = false;
            const camposObrigatorios = ['nome_companheiro', 'cpf_companheiro', 'rg_companheiro', 'idade_companheiro', 'escolaridade_companheiro', 'profissao_companheiro'];
            
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = false;
                    input.style.backgroundColor = '';
                }
            });
            
            camposObrigatorios.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input && !input.value.trim()) {
                    showFieldError(input, 'Campo obrigat√≥rio para n√£o solteiros');
                    hasErrors = true;
                } else if (input) {
                    clearFieldError(input);
                }
            });
            return !hasErrors;
        } else {
            // Habilitar campos se estado civil n√£o selecionado
            companheiroCampos.forEach(campo => {
                const input = document.querySelector(`[name="${campo}"]`);
                if (input) {
                    input.disabled = false;
                    input.style.backgroundColor = '';
                    clearFieldError(input);
                }
            });
            return true;
        }
    }

    // Fun√ß√£o para validar soma da fam√≠lia
    function validateFamiliaSum() {
        const numPessoas = parseInt(document.querySelector('[name="num_pessoas_familia"]')?.value || 0);
        const adultos = parseInt(document.querySelector('[name="adultos"]')?.value || 0);
        const criancas = parseInt(document.querySelector('[name="criancas"]')?.value || 0);
        const adolescentes = parseInt(document.querySelector('[name="adolescentes"]')?.value || 0);
        const idosos = parseInt(document.querySelector('[name="idosos"]')?.value || 0);
        const gestantes = parseInt(document.querySelector('[name="gestantes"]')?.value || 0);
        const nutrizes = parseInt(document.querySelector('[name="nutrizes"]')?.value || 0);
        
        const soma = adultos + criancas + adolescentes + idosos + gestantes + nutrizes;
        const numPessoasInput = document.querySelector('[name="num_pessoas_familia"]');
        
        if (soma > numPessoas) {
            showFieldError(numPessoasInput, `Soma dos membros (${soma}) n√£o pode ser maior que o total (${numPessoas})`);
            return false;
        } else {
            clearFieldError(numPessoasInput);
            return true;
        }
    }

    // Fun√ß√£o para validar campos "Outro" obrigat√≥rios
    function validateOutroFields() {
        const validations = [
            { checkbox: 'trabalho_incomoda_outro', field: 'trabalho_incomoda_outro_desc', label: 'Especifique o que incomoda no trabalho' },
            { checkbox: 'fonte_renda_outro', field: 'fonte_renda_outro_desc', label: 'Especifique a outra fonte de renda' }
        ];
        
        let hasErrors = false;
        validations.forEach(validation => {
            const checkbox = document.querySelector(`[name="${validation.checkbox}"]`);
            const field = document.querySelector(`[name="${validation.field}"]`);
            
            if (checkbox && field && checkbox.checked && !field.value.trim()) {
                showFieldError(field, `${validation.label} √© obrigat√≥rio quando marcado como "Sim"`);
                hasErrors = true;
            } else if (field) {
                clearFieldError(field);
            }
        });
        
        return !hasErrors;
    }
    function validateHorario() {
        const horarioInput = document.querySelector('[name="horario_trabalho"]');
        if (horarioInput && horarioInput.value) {
            const horarioRegex = /^\d{2}:\d{2}\s*a\s*\d{2}:\d{2}$/i;
            if (!horarioRegex.test(horarioInput.value)) {
                showFieldError(horarioInput, 'Formato deve ser HH:MM a HH:MM (ex: 08:00 a 17:00)');
                return false;
            } else {
                clearFieldError(horarioInput);
                return true;
            }
        }
        return true;
    }

    // Fun√ß√£o para mostrar erro no campo
    function showFieldError(input, message) {
        input.style.borderColor = '#dc3545';
        input.style.backgroundColor = '#fff5f5';
        
        let existingError = input.parentNode.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
        
        const error = document.createElement('div');
        error.className = 'validation-error';
        error.style.color = '#dc3545';
        error.style.fontSize = '12px';
        error.style.marginTop = '2px';
        error.textContent = message;
        input.parentNode.appendChild(error);
    }

    // Fun√ß√£o para limpar erro do campo
    function clearFieldError(input) {
        input.style.borderColor = '';
        input.style.backgroundColor = '';
        
        let existingError = input.parentNode.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
    }

    // Adicionar valida√ß√£o em tempo real para todos os campos com limite
    document.addEventListener('DOMContentLoaded', function() {
        Object.keys(FIELD_LIMITS).forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('input', function() {
                    validateField(this);
                });
                
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            }
        });

        // Valida√ß√£o idade vs data nascimento
        const idadeInput = document.querySelector('[name="idade"]');
        const dataNascInput = document.querySelector('[name="data_nascimento"]');
        
        if (idadeInput && dataNascInput) {
            dataNascInput.addEventListener('change', function() {
                if (this.value) {
                    const calculatedAge = calculateAge(this.value);
                    // Remover temporariamente o listener para evitar loop
                    idadeInput.removeEventListener('input', validateAge);
                    idadeInput.value = calculatedAge;
                    // Reativar o listener ap√≥s um pequeno delay
                    setTimeout(() => {
                        idadeInput.addEventListener('input', validateAge);
                    }, 100);
                }
                validateAge();
            });
            
            idadeInput.addEventListener('input', validateAge);
        }

        // Valida√ß√£o estado civil vs companheiro
        const estadoCivilInput = document.querySelector('[name="estado_civil"]');
        if (estadoCivilInput) {
            estadoCivilInput.addEventListener('change', validateCompanheiro);
            // Validar estado inicial
            validateCompanheiro();
        }

        // Valida√ß√£o soma fam√≠lia
        const familiaInputs = ['num_pessoas_familia', 'adultos', 'criancas', 'adolescentes', 'idosos', 'gestantes', 'nutrizes'];
        familiaInputs.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('input', validateFamiliaSum);
            }
        });

        // Valida√ß√£o campos "Outro"
        const outroCheckboxes = ['trabalho_incomoda_outro', 'fonte_renda_outro'];
        outroCheckboxes.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
                input.addEventListener('change', validateOutroFields);
            }
        });

        // Valida√ß√£o hor√°rio trabalho
        const horarioInput = document.querySelector('[name="horario_trabalho"]');
        if (horarioInput) {
            horarioInput.addEventListener('blur', validateHorario);
        }
        
        // Valida√ß√£o no envio do formul√°rio
        document.querySelector('form').addEventListener('submit', function(e) {
            let hasErrors = false;
            
            // Validar limites de caracteres
            Object.keys(FIELD_LIMITS).forEach(fieldName => {
                const input = document.querySelector(`[name="${fieldName}"]`);
                if (input && !validateField(input)) {
                    hasErrors = true;
                }
            });
            
            // Validar regras de neg√≥cio
            if (!validateAge()) hasErrors = true;
            if (!validateCompanheiro()) hasErrors = true;
            if (!validateFamiliaSum()) hasErrors = true;
            if (!validateOutroFields()) hasErrors = true;
            if (!validateHorario()) hasErrors = true;
            
            if (hasErrors) {
                e.preventDefault();
                alert('Por favor, corrija os campos destacados antes de enviar o formul√°rio.');
                return false;
            }
        });
    });
    
    // Interceptar submit do formul√°rio para verificar foto
    document.querySelector('form').addEventListener('submit', function(e) {
        const fotoValue = document.getElementById('fotoBase64').value;
        console.log('üöÄ SUBMIT - Valor da foto:', fotoValue ? 'Presente (' + fotoValue.length + ' chars)' : 'AUSENTE');
        if (!fotoValue) {
            console.warn('‚ö†Ô∏è ATEN√á√ÉO: Formul√°rio sendo enviado SEM foto!');
        }
    });

    // Controle de Captura de Foto
    let stream = null;
    const video = document.getElementById('cameraVideo');
    const canvas = document.getElementById('photoCanvas');
    const ctx = canvas.getContext('2d');
    const placeholder = document.getElementById('photoPlaceholder');
    const startBtn = document.getElementById('startCamera');
    const captureBtn = document.getElementById('capturePhoto');
    const retakeBtn = document.getElementById('retakePhoto');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadInput = document.getElementById('uploadPhoto');
    const fotoBase64Input = document.getElementById('fotoBase64');

    // Abrir c√¢mera
    startBtn.addEventListener('click', async () => {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: 120, 
                    height: 160,
                    facingMode: 'user' 
                } 
            });
            video.srcObject = stream;
            video.style.display = 'block';
            placeholder.style.display = 'none';
            canvas.style.display = 'none';
            startBtn.style.display = 'none';
            captureBtn.style.display = 'inline-block';
        } catch (err) {
            alert('Erro ao acessar a c√¢mera: ' + err.message);
        }
    });

    // Capturar foto
    captureBtn.addEventListener('click', () => {
        ctx.drawImage(video, 0, 0, 120, 160);
        const imageData = canvas.toDataURL('image/jpeg', 0.8);
        fotoBase64Input.value = imageData;
        
        video.style.display = 'none';
        canvas.style.display = 'block';
        captureBtn.style.display = 'none';
        retakeBtn.style.display = 'inline-block';
        
        // Parar stream
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
    });

    // Nova foto
    retakeBtn.addEventListener('click', () => {
        canvas.style.display = 'none';
        placeholder.style.display = 'flex';
        retakeBtn.style.display = 'none';
        startBtn.style.display = 'inline-block';
        fotoBase64Input.value = '';
    });

    // Upload de arquivo
    uploadBtn.addEventListener('click', () => {
        uploadInput.click();
    });

    uploadInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // Redimensionar para 120x160 (3x4)
                    ctx.drawImage(img, 0, 0, 120, 160);
                    const imageData = canvas.toDataURL('image/jpeg', 0.8);
                    fotoBase64Input.value = imageData;
                    
                    placeholder.style.display = 'none';
                    canvas.style.display = 'block';
                    startBtn.style.display = 'none';
                    retakeBtn.style.display = 'inline-block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    // Placeholder clic√°vel
    placeholder.addEventListener('click', () => {
        startBtn.click();
    });
    </script>
</body>
</html>
